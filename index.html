<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS MART | Online Shopping</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .btn-amazon { background: #f0c14b; border: 1px solid #a88734; color: #111; }
        .btn-amazon:hover { background: #ddb347; }
        .input-amazon { border: 1px solid #a6a6a6; box-shadow: 0 1px 0 rgba(255,255,255,.5), 0 1px 0 rgba(0,0,0,.07) inset; }
        .input-amazon:focus { border-color: #e77600; box-shadow: 0 0 3px 2px rgba(228,121,17,.5); outline: none; }
    </style>
</head>
<body class="bg-white font-sans text-sm select-none">

    <div id="login-gate" class="fixed inset-0 bg-white z-[100] flex flex-col items-center pt-10 overflow-y-auto">
        <div class="mb-6 text-center">
            <span class="text-4xl font-bold tracking-tighter">BS <span class="text-[#febd69]">MART</span></span>
            <span class="text-xs text-gray-500 block">.in</span>
        </div>

        <div class="w-full max-w-sm border border-gray-300 rounded p-6 pb-10 shadow-sm bg-white">
            <h2 class="text-2xl font-normal mb-4">Sign In</h2>
            <label class="block font-bold text-xs mb-1 pl-1">Your Name</label>
            <input type="text" id="gate-name" placeholder="First and last name" class="w-full p-2 rounded mb-3 input-amazon">
            <label class="block font-bold text-xs mb-1 pl-1">Mobile Number</label>
            <div class="flex mb-4">
                <span class="bg-gray-100 p-2 border border-r-0 border-gray-300 rounded-l text-gray-600 text-sm flex items-center">+91</span>
                <input type="tel" id="gate-phone" placeholder="9876543210" class="w-full p-2 rounded-r input-amazon">
            </div>
            <button type="button" onclick="directLogin()" class="w-full py-2 rounded-sm text-sm shadow-sm btn-amazon font-normal">Continue to Shop</button>
            <p class="text-[11px] mt-4 text-gray-600 leading-tight">By continuing, you agree to BS Mart's Conditions of Use.</p>
        </div>
    </div>

    <div id="main-app" class="hidden bg-gray-100 min-h-screen pb-20">
        <nav class="bg-[#131921] text-white sticky top-0 z-50 shadow-md">
            <div class="flex justify-between items-center px-4 py-2">
                <div class="flex items-center gap-3">
                    <span class="text-xl font-bold tracking-tighter">BS <span class="text-[#febd69]">MART</span></span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="leading-none text-right">
                        <div class="text-[10px] text-gray-300">Hello, <span id="nav-user">User</span></div>
                        <div class="text-sm font-bold">Account</div>
                    </div>
                    <div onclick="toggleCart()" class="relative cursor-pointer">
                        <i class="fa-solid fa-cart-shopping text-3xl"></i>
                        <span id="cart-count" class="absolute -top-1 left-3 bg-[#febd69] text-[#131921] text-[12px] font-bold px-1.5 rounded-full">0</span>
                    </div>
                </div>
            </div>
            <div class="px-3 pb-3">
                <div class="flex bg-white rounded-md overflow-hidden h-10 shadow-sm">
                    <input type="text" id="search" onkeyup="searchProducts()" placeholder="Search BS MART..." class="w-full px-4 text-gray-700 outline-none text-sm">
                    <button class="bg-[#febd69] w-12 flex justify-center items-center text-[#131921] text-lg"><i class="fa-solid fa-magnifying-glass"></i></button>
                </div>
            </div>
        </nav>

        <div id="loading" class="text-center py-20">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-[#232f3e]"></i>
            <p class="mt-2 text-gray-500">Loading Products...</p>
        </div>
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 gap-2 p-2 bg-gray-100"></div>
    </div>

    <div id="product-page" class="fixed inset-0 bg-white z-[60] hidden overflow-y-auto">
        <div class="bg-[#232f3e] text-white p-3 flex items-center gap-3 sticky top-0 shadow z-10">
            <button onclick="closeProductPage()"><i class="fa-solid fa-arrow-left text-lg"></i></button>
            <span class="font-bold">Details</span>
        </div>
        <div class="p-4 pb-32">
            <div class="relative">
                <div class="h-72 flex justify-center items-center bg-gray-50 mb-4 rounded border">
                    <img id="pp-img" src="" class="max-h-full max-w-full object-contain">
                </div>
                <span id="pp-badge" class="hidden absolute top-2 right-2 bg-[#cc0c39] text-white text-xs font-bold px-2 py-1 rounded-full shadow"></span>
            </div>
            <h1 id="pp-title" class="text-lg font-medium text-gray-800 leading-snug mb-2"></h1>
            
            <div class="bg-gray-50 p-3 rounded mb-4 border border-gray-100">
                <div class="flex items-baseline gap-2">
                    <span id="pp-discount-text" class="text-[#cc0c39] text-xl font-light hidden"></span>
                    <span class="text-3xl font-bold text-gray-900">₹<span id="pp-price"></span></span>
                </div>
                <p id="pp-mrp-block" class="text-xs text-gray-500 mt-1 hidden">M.R.P.: <span class="line-through" id="pp-old-price"></span></p>
            </div>

            <div class="mb-5">
                <p class="font-bold text-sm mb-2 text-gray-800">Select Size</p>
                <div class="flex gap-3">
                    <button onclick="selectSize(this, 'S')" class="size-btn border rounded px-4 py-2 text-sm font-bold">S</button>
                    <button onclick="selectSize(this, 'M')" class="size-btn border rounded px-4 py-2 text-sm font-bold">M</button>
                    <button onclick="selectSize(this, 'L')" class="size-btn border rounded px-4 py-2 text-sm font-bold">L</button>
                    <button onclick="selectSize(this, 'XL')" class="size-btn border rounded px-4 py-2 text-sm font-bold">XL</button>
                </div>
            </div>
            <div class="fixed bottom-0 left-0 right-0 bg-white p-3 flex gap-2 shadow-lg">
                <button onclick="addToCartCurrent()" class="flex-1 bg-[#fffae6] border border-[#ffd814] py-3 rounded-full font-bold text-sm">Add to Cart</button>
                <button onclick="toggleCart()" class="flex-1 btn-amazon py-3 rounded-full font-bold text-sm">Buy Now</button>
            </div>
        </div>
    </div>

    <div id="cart-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex justify-end">
        <div class="bg-white w-full md:w-96 h-full shadow-2xl flex flex-col">
            <div class="bg-[#232f3e] text-white p-4 flex justify-between items-center">
                <h2 class="font-bold">Your Cart</h2>
                <button onclick="toggleCart()"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div id="cart-items-container" class="flex-1 overflow-y-auto p-3 space-y-3 bg-gray-100"></div>
            <div class="p-3 bg-white border-t">
                <textarea id="delivery-address" class="w-full border p-2 text-sm rounded mb-2" rows="2" placeholder="House No, Street, City..."></textarea>
                <div class="flex justify-between font-bold text-xl mb-2 text-[#B12704]"><span>Total:</span><span>₹<span id="cart-total">0</span></span></div>
                <button onclick="checkoutCart()" id="buy-btn" class="w-full btn-amazon py-3 rounded shadow">Place Order</button>
            </div>
        </div>
    </div>

    <div id="invoice-modal" class="fixed inset-0 bg-black bg-opacity-80 z-[80] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-6 text-center rounded">
            <i class="fa-solid fa-check-circle text-green-500 text-5xl mb-3"></i>
            <h3 class="font-bold text-xl mb-2">Order Placed!</h3>
            <button onclick="location.reload()" class="w-full btn-amazon py-3 rounded font-bold">Continue Shopping</button>
        </div>
    </div>

    <script>
        // --- LOGIC ---
        window.onload = function() {
            if (localStorage.getItem('bsmart_username')) {
                document.getElementById('login-gate').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('nav-user').innerText = localStorage.getItem('bsmart_username');
            } else {
                document.getElementById('login-gate').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        };

        function directLogin() {
            const name = document.getElementById('gate-name').value;
            const phone = document.getElementById('gate-phone').value;
            if(name.length < 3 || phone.length < 10) return alert("Enter valid details");
            localStorage.setItem('bsmart_username', name);
            localStorage.setItem('bsmart_phone', phone);
            
            // Email Notification
            const fd = new FormData();
            fd.append("_captcha", "false"); fd.append("_subject", "New Customer Login");
            fd.append("Details", `${name} - ${phone}`);
            fetch("https://formsubmit.co/suheemsuheem752@gmail.com", { method: "POST", body: fd });

            document.getElementById('login-gate').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('nav-user').innerText = name;
        }

        // --- PRODUCTS & DISCOUNT LOGIC ---
        let allProducts = [], cart = JSON.parse(localStorage.getItem('bsmart_cart')) || [], currentProduct = null, selectedSize = null;

        fetch("https://script.google.com/macros/s/AKfycby7FbnXt9tqKFK_OfuUd7dVwdSmYunenmvLJGY9yGmpHUI2NDDzPXPIYnDhfHRiP_2q/exec")
            .then(res => res.json()).then(data => { allProducts = data; document.getElementById('loading').style.display = 'none'; renderGrid(data); updateCartUI(); });

        function getOldPrice(p) { return p.Old_Price || p["Old Price"] || p.MRP || 0; }

        function renderGrid(products) {
            const grid = document.getElementById('product-grid'); grid.innerHTML = "";
            products.forEach((p, i) => {
                const price = Number(p.Price || p.price);
                const oldPrice = Number(getOldPrice(p));
                
                // Calculate Discount
                let discountHTML = "";
                let oldPriceHTML = "";
                if (oldPrice > price) {
                    const percent = Math.floor(((oldPrice - price) / oldPrice) * 100);
                    discountHTML = `<span class="absolute top-2 left-2 bg-[#cc0c39] text-white text-[10px] font-bold px-2 py-1 rounded-sm">${percent}% off</span>`;
                    oldPriceHTML = `<span class="text-xs text-gray-500 line-through ml-1">₹${oldPrice}</span>`;
                }

                grid.innerHTML += `
                    <div onclick="openProduct(${i})" class="bg-white p-2 border border-gray-200 cursor-pointer h-64 flex flex-col justify-between relative">
                        ${discountHTML}
                        <div class="h-32 flex justify-center items-center"><img src="${p.Image || p.image}" class="h-full object-contain"></div>
                        <h3 class="text-xs line-clamp-2 hover:text-[#e77600]">${p.Name || p.name}</h3>
                        <div class="flex items-baseline">
                            <span class="font-bold text-lg">₹${price}</span>
                            ${oldPriceHTML}
                        </div>
                    </div>`;
            });
        }

        function openProduct(i) {
            currentProduct = allProducts[i];
            const price = Number(currentProduct.Price || currentProduct.price);
            const oldPrice = Number(getOldPrice(currentProduct));

            document.getElementById('pp-img').src = currentProduct.Image || currentProduct.image;
            document.getElementById('pp-title').innerText = currentProduct.Name || currentProduct.name;
            document.getElementById('pp-price').innerText = price;
            
            // Show Discount Details
            if (oldPrice > price) {
                const percent = Math.floor(((oldPrice - price) / oldPrice) * 100);
                document.getElementById('pp-badge').innerText = `${percent}% OFF`;
                document.getElementById('pp-badge').classList.remove('hidden');
                document.getElementById('pp-discount-text').innerText = `-${percent}%`;
                document.getElementById('pp-discount-text').classList.remove('hidden');
                document.getElementById('pp-old-price').innerText = "₹" + oldPrice;
                document.getElementById('pp-mrp-block').classList.remove('hidden');
            } else {
                document.getElementById('pp-badge').classList.add('hidden');
                document.getElementById('pp-discount-text').classList.add('hidden');
                document.getElementById('pp-mrp-block').classList.add('hidden');
            }

            document.getElementById('product-page').classList.remove('hidden');
        }

        function addToCartCurrent() {
            if(!currentProduct) return;
            cart.push({ name: currentProduct.Name || currentProduct.name, price: currentProduct.Price || currentProduct.price, image: currentProduct.Image || currentProduct.image, size: selectedSize || "Std" });
            localStorage.setItem('bsmart_cart', JSON.stringify(cart));
            updateCartUI(); alert("Added to Cart"); document.getElementById('product-page').classList.add('hidden');
        }

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.length;
            const con = document.getElementById('cart-items-container'); con.innerHTML = "";
            let total = 0;
            cart.forEach((item, i) => {
                total += Number(item.price);
                con.innerHTML += `<div class="flex gap-2 bg-white p-2 border mb-1"><img src="${item.image}" class="w-10 h-10 object-contain"><div><div class="text-xs font-bold line-clamp-1">${item.name}</div><div class="text-[#B12704] font-bold">₹${item.price}</div></div><button onclick="cart.splice(${i},1); localStorage.setItem('bsmart_cart', JSON.stringify(cart)); updateCartUI()" class="text-xs ml-auto text-gray-400">Delete</button></div>`;
            });
            document.getElementById('cart-total').innerText = total;
        }

        function checkoutCart() {
            if(cart.length===0) return alert("Empty Cart");
            const address = document.getElementById('delivery-address').value;
            if(address.length < 5) return alert("Enter Address");
            const btn = document.getElementById('buy-btn'); btn.innerText = "Processing..."; btn.disabled = true;

            const name = localStorage.getItem('bsmart_username');
            const phone = localStorage.getItem('bsmart_phone');
            let items = ""; cart.forEach(i => { items += `${i.name} (Size: ${i.size}) - ₹${i.price}\n`; });

            const fd = new FormData();
            fd.append("_captcha", "false"); fd.append("_subject", "NEW ORDER: " + name);
            fd.append("Details", `Customer: ${name} (${phone})\nAddress: ${address}\nTotal: ₹${document.getElementById('cart-total').innerText}\nItems:\n${items}`);

            fetch("https://formsubmit.co/suheemsuheem752@gmail.com", { method: "POST", body: fd })
                .then(() => { cart = []; localStorage.setItem('bsmart_cart', JSON.stringify(cart)); updateCartUI(); document.getElementById('cart-sidebar').classList.add('hidden'); document.getElementById('invoice-modal').classList.remove('hidden'); })
                .finally(() => { btn.innerText = "Place Order"; btn.disabled = false; });
        }

        function closeProductPage() { document.getElementById('product-page').classList.add('hidden'); }
        function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('hidden'); }
        function selectSize(btn, s) { selectedSize = s; document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('bg-yellow-400')); btn.classList.add('bg-yellow-400'); }
        function searchProducts() { const q = document.getElementById('search').value.toLowerCase(); renderGrid(allProducts.filter(p => (p.Name||p.name).toLowerCase().includes(q))); }
    </script>
</body>
</html>
