<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BS MART | Ultimate Store</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { primary: '#0F172A', accent: '#F59E0B', surface: '#F8FAFC', success: '#10B981', danger: '#EF4444' }
                }
            }
        }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        body { -webkit-tap-highlight-color: transparent; }
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .toast {
            visibility: hidden; min-width: 250px; background-color: #1e293b; color: #fff;
            text-align: center; border-radius: 50px; padding: 12px 24px; position: fixed; z-index: 120;
            left: 50%; bottom: 100px; transform: translateX(-50%); font-size: 14px; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 100px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 100px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body class="bg-surface text-slate-800 antialiased pb-24">

    <div id="login-screen" class="fixed inset-0 bg-white z-[100] flex flex-col justify-center items-center p-6">
        <div class="w-20 h-20 bg-primary rounded-2xl flex items-center justify-center mb-6 shadow-xl shadow-blue-900/20">
            <span class="text-3xl font-bold text-accent">BS</span>
        </div>
        <h1 class="text-3xl font-bold text-slate-900 mb-2">Welcome Back</h1>
        <p class="text-slate-500 mb-8 text-sm">Sign in to continue shopping</p>
        <div class="w-full max-w-sm space-y-4">
            <input type="text" id="login-name" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:border-accent font-medium transition" placeholder="Full Name">
            <input type="tel" id="login-phone" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:border-accent font-medium transition" placeholder="Mobile Number">
            <button onclick="doLogin()" class="w-full bg-primary text-white py-4 rounded-xl font-bold shadow-lg shadow-slate-900/20 active:scale-95 transition-transform">
                Start Shopping
            </button>
        </div>
    </div>

    <div id="website" class="hidden relative">
        <header class="fixed top-0 w-full z-40 glass transition-all duration-300">
            <div class="flex justify-between items-center px-4 py-3">
                <div onclick="adminTrigger()" class="cursor-pointer">
                    <span class="text-xl font-extrabold tracking-tight text-primary">BS <span class="text-accent">MART</span></span>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="toggleSearch()" class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-600"><i class="fa-solid fa-search"></i></button>
                    <button onclick="toggleCart()" class="relative w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center shadow-lg shadow-blue-900/20">
                        <i class="fa-solid fa-bag-shopping"></i>
                        <span id="cart-badge" class="absolute -top-1 -right-1 bg-accent text-primary text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full border-2 border-white">0</span>
                    </button>
                </div>
            </div>
            <div class="px-4 pb-3 overflow-x-auto no-scrollbar">
                <div class="flex space-x-3">
                    <button onclick="filterCategory('All')" class="px-5 py-2 bg-slate-900 text-white rounded-full text-xs font-semibold shadow-md active:scale-95 transition">All</button>
                    <button onclick="filterCategory('Mens Wear')" class="px-5 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-semibold active:scale-95 transition">Men</button>
                    <button onclick="filterCategory('Womens')" class="px-5 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-semibold active:scale-95 transition">Women</button>
                    <button onclick="filterCategory('Electronics')" class="px-5 py-2 bg-white border border-slate-200 text-slate-600 rounded-full text-xs font-semibold active:scale-95 transition">Gadgets</button>
                </div>
            </div>
        </header>

        <div id="search-bar" class="hidden fixed top-[60px] left-0 w-full bg-white z-30 p-4 border-b shadow-sm slide-up">
            <div class="relative">
                <i class="fa-solid fa-search absolute left-4 top-3.5 text-gray-400"></i>
                <input type="text" id="search-inp" onkeyup="searchProduct()" placeholder="Search items..." class="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-xl outline-none text-sm">
            </div>
        </div>

        <main class="pt-[115px] px-4 pb-10 min-h-screen">
            <div class="relative w-full h-48 md:h-64 rounded-2xl overflow-hidden mb-6 shadow-lg bg-gray-200">
                <img id="slider-img" src="https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=1000" class="w-full h-full object-cover transition-opacity duration-700">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-6">
                    <div>
                        <span class="bg-accent text-primary text-[10px] font-bold px-2 py-1 rounded mb-2 inline-block">NEW ARRIVAL</span>
                        <h2 class="text-white text-2xl font-bold">Premium Collection</h2>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold text-slate-800">Popular Products</h2>
                <span class="text-xs text-slate-400 font-medium">View All</span>
            </div>

            <div id="loading" class="text-center py-10">
                <div class="w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"></div>
                <p class="mt-4 text-xs text-slate-400 font-medium tracking-wide">LOADING STORE...</p>
            </div>

            <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>

            <div class="mt-10 p-6 bg-white rounded-2xl border border-slate-100 shadow-sm">
                <h3 class="font-bold text-lg mb-3 text-primary">About BS MART</h3>
                <p class="text-xs text-slate-500 mb-6 leading-relaxed">
                    BS MART is India's most trusted online store for Fashion and Electronics. 
                    We guarantee <span class="text-success font-bold">100% Original Products</span>, secure payments via UPI/QR, and express delivery.
                </p>
                <h4 class="font-bold text-sm mb-3 text-primary">Contact Us</h4>
                <div class="space-y-3 text-xs text-slate-600">
                    <p class="flex items-center gap-2"><i class="fa-solid fa-envelope text-accent"></i> suheemsuheem752@gmail.com</p>
                    <p class="flex items-center gap-2"><i class="fa-solid fa-phone text-accent"></i> +91 99999 99999</p>
                    <p class="flex items-center gap-2"><i class="fa-solid fa-location-dot text-accent"></i> New Delhi, India</p>
                </div>
            </div>
        </main>

        <nav class="fixed bottom-0 w-full bg-white border-t border-slate-100 pb-safe z-40 flex justify-around items-center py-3 shadow-[0_-5px_20px_rgba(0,0,0,0.03)]">
            <button onclick="window.scrollTo(0,0)" class="nav-btn flex flex-col items-center gap-1 text-primary"><i class="fa-solid fa-house text-lg"></i><span class="text-[10px] font-medium">Home</span></button>
            <button onclick="toggleWishlist()" class="nav-btn flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition"><i class="fa-regular fa-heart text-lg"></i><span class="text-[10px] font-medium">Saved</span></button>
            <div class="w-12"></div>
            <button onclick="openSupport()" class="nav-btn flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition"><i class="fa-brands fa-whatsapp text-lg"></i><span class="text-[10px] font-medium">Chat</span></button>
            <button onclick="openAccount()" class="nav-btn flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition"><i class="fa-regular fa-user text-lg"></i><span class="text-[10px] font-medium">Profile</span></button>
            <button onclick="toggleCart()" class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-primary text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg shadow-blue-900/30 border-4 border-white active:scale-95 transition"><i class="fa-solid fa-bag-shopping text-xl"></i></button>
        </nav>
    </div>

    <div id="details-page" class="fixed inset-0 bg-white z-[60] hidden overflow-y-auto slide-up">
        <div class="relative bg-white min-h-screen">
            <div class="bg-slate-50 h-[45vh] relative rounded-b-[2.5rem] overflow-hidden">
                <div class="absolute top-4 left-4 z-10"><button onclick="closeDetails()" class="w-10 h-10 bg-white/80 backdrop-blur rounded-full flex items-center justify-center shadow-sm"><i class="fa-solid fa-arrow-left"></i></button></div>
                <div class="absolute top-4 right-4 z-10"><button onclick="toggleWishlistCurrent()" class="w-10 h-10 bg-white/80 backdrop-blur rounded-full flex items-center justify-center shadow-sm text-red-500"><i id="dt-wish-icon" class="fa-regular fa-heart"></i></button></div>
                <img id="dt-img" src="" class="w-full h-full object-contain mix-blend-multiply p-8">
            </div>
            <div class="p-6 pb-32">
                <div class="flex justify-between items-start mb-2">
                    <h1 id="dt-name" class="text-2xl font-bold text-slate-800 w-3/4 leading-tight"></h1>
                    <div class="text-right">
                        <span class="text-2xl font-bold text-primary block">₹<span id="dt-price"></span></span>
                        <span id="dt-off" class="text-xs font-bold text-white bg-danger px-2 py-0.5 rounded shadow-sm"></span>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 mb-6 border-b pb-4 border-slate-100">
                    <div class="flex text-accent text-xs"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half-stroke"></i></div>
                    <span class="text-sm font-bold text-slate-700">4.8</span>
                    <span class="text-sm text-slate-400">(240 Reviews)</span>
                </div>

                <div class="mb-6">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Select Size</h3>
                    <div class="flex gap-3">
                        <button onclick="setSize(this, 'S')" class="size-box w-12 h-12 rounded-xl border border-slate-200 font-bold text-slate-600 hover:border-primary hover:text-primary transition">S</button>
                        <button onclick="setSize(this, 'M')" class="size-box w-12 h-12 rounded-xl border border-slate-200 font-bold text-slate-600 hover:border-primary hover:text-primary transition">M</button>
                        <button onclick="setSize(this, 'L')" class="size-box w-12 h-12 rounded-xl border border-slate-200 font-bold text-slate-600 hover:border-primary hover:text-primary transition">L</button>
                        <button onclick="setSize(this, 'XL')" class="size-box w-12 h-12 rounded-xl border border-slate-200 font-bold text-slate-600 hover:border-primary hover:text-primary transition">XL</button>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-2">Description</h3>
                    <div class="bg-slate-50 p-4 rounded-xl mb-6 border border-slate-100">
                        <p id="dt-desc" class="text-sm text-slate-600 leading-relaxed">Loading details...</p>
                    </div>

                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Customer Reviews</h3>
                    <div class="space-y-3">
                        <div class="bg-white border border-slate-100 p-4 rounded-xl shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center text-xs font-bold text-slate-600">AK</div>
                                <div>
                                    <p class="font-bold text-xs text-slate-800">Amit Kumar</p>
                                    <p class="text-[10px] text-accent">★★★★★</p>
                                </div>
                                <span class="ml-auto text-[10px] text-slate-400">2 days ago</span>
                            </div>
                            <p class="text-xs text-slate-500 leading-relaxed">Product quality is amazing. Highly recommended! Delivery was super fast.</p>
                        </div>
                        <div class="bg-white border border-slate-100 p-4 rounded-xl shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center text-xs font-bold text-slate-600">RS</div>
                                <div>
                                    <p class="font-bold text-xs text-slate-800">Rahul Singh</p>
                                    <p class="text-[10px] text-accent">★★★★☆</p>
                                </div>
                                <span class="ml-auto text-[10px] text-slate-400">1 week ago</span>
                            </div>
                            <p class="text-xs text-slate-500 leading-relaxed">Good fit, fabric is comfortable. Value for money product.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="fixed bottom-0 w-full bg-white border-t p-4 flex gap-4 z-50 pb-8 shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
            <button onclick="addToCart()" class="flex-1 py-3.5 rounded-xl bg-slate-100 text-slate-900 font-bold hover:bg-slate-200 transition">Add to Cart</button>
            <button onclick="buyNow()" class="flex-1 py-3.5 rounded-xl bg-primary text-white font-bold shadow-lg shadow-blue-900/20 active:scale-95 transition">Buy Now</button>
        </div>
    </div>

    <div id="cart-sidebar" class="fixed inset-0 bg-black/60 z-[90] hidden flex justify-end backdrop-blur-sm fade-in">
        <div class="bg-white w-full md:w-[400px] h-full shadow-2xl flex flex-col slide-up">
            <div class="bg-surface p-5 flex justify-between items-center border-b">
                <h2 class="font-bold text-xl">Checkout</h2>
                <button onclick="toggleCart()" class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm"><i class="fa-solid fa-times"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-5 space-y-6">
                <div id="cart-list" class="space-y-4"></div>
                
                <div class="flex gap-2">
                    <input type="text" id="coupon-code" placeholder="BSMART10" class="flex-1 p-3 bg-slate-50 border rounded-xl text-sm outline-none uppercase font-bold">
                    <button onclick="applyCoupon()" class="bg-slate-800 text-white px-5 rounded-xl text-sm font-bold">Apply</button>
                </div>

                <div class="bg-slate-50 p-4 rounded-xl space-y-2 border border-slate-100">
                    <div class="flex justify-between text-sm text-slate-500"><span>Subtotal</span><span>₹<span id="sub-total">0</span></span></div>
                    <div class="flex justify-between text-sm text-green-600"><span>Discount</span><span>- ₹<span id="discount-val">0</span></span></div>
                    <div class="flex justify-between text-lg font-bold text-slate-900 pt-2 border-t border-slate-200"><span>Total</span><span>₹<span id="total-price">0</span></span></div>
                </div>

                <div>
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Shipping Details</h3>
                    <input type="text" id="co-name" placeholder="Full Name" class="w-full p-3 mb-2 bg-white border rounded-xl text-sm outline-none">
                    <input type="tel" id="co-phone" placeholder="Mobile" class="w-full p-3 mb-2 bg-white border rounded-xl text-sm outline-none">
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="co-pin" placeholder="Pincode" class="w-1/2 p-3 bg-white border rounded-xl text-sm outline-none">
                        <input type="text" id="co-mark" placeholder="Landmark" class="w-1/2 p-3 bg-white border rounded-xl text-sm outline-none">
                    </div>
                    <textarea id="co-addr" placeholder="Full Address" class="w-full p-3 bg-white border rounded-xl text-sm outline-none mb-4" rows="2"></textarea>
                    
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Payment Method</h3>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <label class="border p-3 rounded-xl flex items-center gap-2 cursor-pointer has-[:checked]:border-primary has-[:checked]:bg-slate-50 transition">
                            <input type="radio" name="payment" value="COD" checked onclick="toggleQR(false)" class="accent-primary">
                            <span class="text-sm font-bold">Cash</span>
                        </label>
                        <label class="border p-3 rounded-xl flex items-center gap-2 cursor-pointer has-[:checked]:border-primary has-[:checked]:bg-slate-50 transition">
                            <input type="radio" name="payment" value="Online" onclick="toggleQR(true)" class="accent-primary">
                            <span class="text-sm font-bold">UPI / QR</span>
                        </label>
                    </div>
                    
                    <div id="qr-box" class="hidden text-center bg-white p-4 border rounded-xl shadow-sm mb-4">
                        <img id="qr-img" src="" class="w-32 h-32 mx-auto mb-2">
                        <p class="text-xs text-slate-500 font-bold">Scan to Pay & Place Order</p>
                    </div>
                </div>
            </div>
            
            <div class="p-5 border-t bg-white">
                <button onclick="placeOrder()" id="order-btn" class="w-full bg-primary text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-900/20 active:scale-95 transition">
                    Place Order
                </button>
            </div>
        </div>
    </div>

    <div id="invoice-modal" class="fixed inset-0 bg-black/80 z-[120] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 text-center shadow-2xl relative slide-up">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl shadow-sm"><i class="fa-solid fa-check"></i></div>
            <h2 class="text-2xl font-bold text-slate-900 mb-1">Order Placed!</h2>
            <p class="text-sm text-slate-500 mb-6">Thank you for shopping with us.</p>
            
            <div class="bg-slate-50 rounded-2xl p-5 text-left mb-6 border border-slate-100 dashed-border">
                <div class="flex justify-between text-xs text-slate-500 mb-2"><span>Order ID</span><span id="inv-id" class="font-mono font-bold text-slate-800">#BS0000</span></div>
                <div class="flex justify-between text-xs text-slate-500 mb-2"><span>Date</span><span id="inv-date" class="text-slate-800">--/--/----</span></div>
                <div class="flex justify-between text-xs text-slate-500 mb-4"><span>Status</span><span class="text-green-600 font-bold">Processing</span></div>
                <div class="border-t border-slate-200 my-3"></div>
                <div class="flex justify-between text-sm font-bold text-slate-900"><span>Amount Paid</span><span id="inv-total">₹0</span></div>
            </div>
            <button onclick="closeInvoice()" class="w-full bg-slate-900 text-white py-3.5 rounded-xl font-bold active:scale-95 transition">Continue Shopping</button>
        </div>
    </div>

    <div id="account-sidebar" class="fixed inset-0 bg-black/60 z-[90] hidden flex justify-end backdrop-blur-sm fade-in">
        <div class="bg-white w-full md:w-[350px] h-full shadow-2xl flex flex-col slide-up">
            <div class="bg-primary text-white p-8 rounded-bl-[3rem]">
                <div class="flex justify-between mb-6">
                    <h2 class="text-2xl font-bold">Profile</h2>
                    <button onclick="toggleAccount()"><i class="fa-solid fa-times text-xl opacity-80"></i></button>
                </div>
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center text-3xl font-bold text-accent">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    <div>
                        <h3 id="acc-name" class="font-bold text-xl">User</h3>
                        <p id="acc-phone" class="text-sm opacity-60">+91 XXXXX</p>
                    </div>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <h3 class="text-xs font-bold text-slate-400 uppercase mb-4">Order History (Track)</h3>
                <div id="order-history-list" class="space-y-4"></div>
            </div>
            <div class="p-6">
                <button onclick="logout()" class="w-full border border-red-100 text-red-500 py-3 rounded-xl font-bold bg-red-50 hover:bg-red-100 transition">Sign Out</button>
            </div>
        </div>
    </div>

    <div id="wishlist-sidebar" class="fixed inset-0 bg-black/60 z-[90] hidden flex justify-end backdrop-blur-sm fade-in">
        <div class="bg-white w-full md:w-[350px] h-full shadow-2xl flex flex-col slide-up">
            <div class="bg-surface p-5 flex justify-between items-center border-b"><h2 class="font-bold text-xl">My Wishlist</h2><button onclick="toggleWishlist()" class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm"><i class="fa-solid fa-times"></i></button></div>
            <div id="wishlist-list" class="flex-1 overflow-y-auto p-5 space-y-3"></div>
        </div>
    </div>

    <div id="toast" class="toast">Notification</div>
    <div id="admin-panel" class="fixed inset-0 bg-black/90 z-[110] hidden flex items-center justify-center">
        <div class="bg-white p-6 rounded-2xl w-80 shadow-2xl">
            <h3 class="font-bold text-lg mb-4">Add Product</h3>
            <input type="text" id="a-name" placeholder="Name" class="w-full border p-2 mb-2 rounded-lg text-sm">
            <input type="number" id="a-price" placeholder="Price" class="w-full border p-2 mb-2 rounded-lg text-sm">
            <input type="number" id="a-old" placeholder="MRP" class="w-full border p-2 mb-2 rounded-lg text-sm">
            <select id="a-cat" class="w-full border p-2 mb-2 rounded-lg text-sm"><option>Mens Wear</option><option>Womens</option><option>Electronics</option></select>
            <textarea id="a-desc" placeholder="Description" class="w-full border p-2 mb-2 rounded-lg text-sm"></textarea>
            <input type="file" id="a-file" class="w-full text-xs mb-3">
            <button onclick="uploadProduct()" id="upload-btn" class="w-full bg-primary text-white py-2 rounded-lg font-bold">Save Product</button>
            <button onclick="document.getElementById('admin-panel').classList.add('hidden')" class="w-full mt-2 text-sm text-gray-500">Close</button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby7FbnXt9tqKFK_OfuUd7dVwdSmYunenmvLJGY9yGmpHUI2NDDzPXPIYnDhfHRiP_2q/exec";
        const UPI_ID = "bsuheem23@okhdfcbank"; 
        const UPI_NAME = "Bhat Suheem";
        const FORCE_LOGOUT_KEY = "v6.0_logout"; // Bump version to logout old users

        let products=[], cart=[], wishlist=[], current=null, size=null, discount=0;
        let orderHistory = JSON.parse(localStorage.getItem('bs_orders')) || [];
        const slides = ["https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=1000", "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?q=80&w=1000", "https://plus.unsplash.com/premium_photo-1664202526559-e21e9c0fb46a?q=80&w=1000"];
        let slideIdx = 0;

        window.onload = function() {
            // FORCE LOGOUT LOGIC
            if(localStorage.getItem('app_ver') !== FORCE_LOGOUT_KEY) { 
                localStorage.removeItem('bs_user'); 
                localStorage.removeItem('bs_phone'); 
                localStorage.setItem('app_ver', FORCE_LOGOUT_KEY); 
            }

            const user = localStorage.getItem('bs_user');
            if(user) showWebsite(user);
            
            const cached = localStorage.getItem('bs_products_cache');
            if(cached) { products = JSON.parse(cached); renderProducts(products); document.getElementById('loading').style.display='none'; }
            fetch(API_URL).then(r=>r.json()).then(d=>{ products=d; localStorage.setItem('bs_products_cache', JSON.stringify(d)); document.getElementById('loading').style.display='none'; renderProducts(d); });
            cart = JSON.parse(localStorage.getItem('bs_cart'))||[]; updateCart();
            wishlist = JSON.parse(localStorage.getItem('bs_wish'))||[];
            setInterval(() => { slideIdx = (slideIdx + 1) % slides.length; document.getElementById('slider-img').src = slides[slideIdx]; }, 3500);
        };

        function doLogin() {
            const name = document.getElementById('login-name').value;
            const phone = document.getElementById('login-phone').value;
            if(name.length<3 || phone.length<10) return showToast("Enter valid details");
            
            localStorage.setItem('bs_user', name); localStorage.setItem('bs_phone', phone);
            showWebsite(name);

            // Background Email
            const fd = new FormData(); fd.append("_captcha", "false"); fd.append("_subject", "Login: " + name); fd.append("Details", `${name} - ${phone}`);
            fetch("https://formsubmit.co/suheemsuheem752@gmail.com", { method: "POST", body: fd });
        }

        function showWebsite(name) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('website').classList.remove('hidden');
            document.getElementById('co-name').value = name;
            document.getElementById('co-phone').value = localStorage.getItem('bs_phone');
        }
        function logout() { if(confirm("Logout?")) { localStorage.clear(); location.reload(); } }

        function renderProducts(list) {
            const grid = document.getElementById('grid'); grid.innerHTML = "";
            list.forEach((p, i) => {
                const price = Number(p.Price||p.price); const old = Number(p.Old_Price||p["Old Price"]||p.MRP||0);
                // DISCOUNT BADGE
                let badge = old>price ? `<span class="absolute top-3 left-3 bg-danger text-white text-[10px] font-bold px-2 py-1 rounded-full shadow">${Math.floor(((old-price)/old)*100)}% OFF</span>` : "";
                grid.innerHTML += `<div onclick="openDetails(${i})" class="bg-white rounded-2xl p-3 shadow-sm border border-slate-100 active:scale-95 transition-transform duration-200"><div class="relative h-44 flex justify-center items-center bg-surface rounded-xl mb-3 overflow-hidden">${badge}<img src="${p.Image||p.image}" class="h-full object-contain mix-blend-multiply" loading="lazy"></div><h3 class="text-xs font-bold text-slate-800 line-clamp-1 mb-1">${p.Name||p.name}</h3><div class="flex items-baseline gap-2"><span class="text-sm font-bold text-primary">₹${price}</span><span class="text-[10px] text-slate-400 line-through">${old>price ? '₹'+old : ''}</span></div></div>`;
            });
        }

        function filterCategory(cat) { if(cat==='All') renderProducts(products); else renderProducts(products.filter(p=>(p.Category||p.category)===cat)); }
        function searchProduct() { const q = document.getElementById('search-inp').value.toLowerCase(); renderProducts(products.filter(p=>(p.Name||p.name).toLowerCase().includes(q))); }
        function toggleSearch() { document.getElementById('search-bar').classList.toggle('hidden'); }

        function openDetails(i) {
            current = products[i]; const p = current;
            const price = Number(p.Price||p.price); const old = Number(p.Old_Price||p["Old Price"]||p.MRP||0);
            document.getElementById('dt-img').src = p.Image||p.image; document.getElementById('dt-name').innerText = p.Name||p.name;
            document.getElementById('dt-price').innerText = price; 
            document.getElementById('dt-desc').innerText = p.Description || p.description || "Premium quality product. 100% Authentic.";
            
            const isWish = wishlist.some(x => (x.Name||x.name) === (p.Name||p.name));
            document.getElementById('dt-wish-icon').className = isWish ? "fa-solid fa-heart" : "fa-regular fa-heart";
            
            // DISCOUNT IN DETAILS
            if(old>price) { document.getElementById('dt-off').innerText = `-${Math.floor(((old-price)/old)*100)}%`; document.getElementById('dt-off').classList.remove('hidden'); } else document.getElementById('dt-off').classList.add('hidden');
            
            document.getElementById('details-page').classList.remove('hidden');
        }

        function toggleWishlistCurrent() {
            if(!current) return;
            const idx = wishlist.findIndex(x => (x.Name||x.name) === (current.Name||current.name));
            if(idx > -1) { wishlist.splice(idx,1); document.getElementById('dt-wish-icon').className = "fa-regular fa-heart"; showToast("Removed"); }
            else { wishlist.push(current); document.getElementById('dt-wish-icon').className = "fa-solid fa-heart"; showToast("Saved"); }
            localStorage.setItem('bs_wish', JSON.stringify(wishlist));
        }

        function toggleWishlist() {
            const list = document.getElementById('wishlist-list'); list.innerHTML = "";
            if(wishlist.length===0) list.innerHTML = "<p class='text-center text-slate-400 text-sm mt-10'>Empty Wishlist</p>";
            wishlist.forEach((item, i) => {
                list.innerHTML += `<div class="flex gap-3 bg-slate-50 p-3 rounded-xl mb-2 items-center"><img src="${item.Image||item.image}" class="w-12 h-12 object-contain bg-white rounded-lg"><div class="flex-1"><h4 class="text-xs font-bold line-clamp-1">${item.Name||item.name}</h4><p class="text-xs font-bold text-primary">₹${item.Price||item.price}</p></div><button onclick="wishlist.splice(${i},1); localStorage.setItem('bs_wish', JSON.stringify(wishlist)); toggleWishlist();" class="text-slate-400"><i class="fa-solid fa-trash"></i></button></div>`;
            });
            document.getElementById('wishlist-sidebar').classList.toggle('hidden');
        }

        function setSize(btn, s) { size=s; document.querySelectorAll('.size-box').forEach(b=>b.classList.remove('border-primary','text-primary')); btn.classList.add('border-primary','text-primary'); }
        function addToCart() { if(!current) return; cart.push({...current, size:size||'Std'}); localStorage.setItem('bs_cart', JSON.stringify(cart)); updateCart(); showToast("Added to Bag"); closeDetails(); }
        function closeDetails() { document.getElementById('details-page').classList.add('hidden'); }
        
        function updateCart() {
            document.getElementById('cart-badge').innerText = cart.length;
            const list = document.getElementById('cart-list'); list.innerHTML = ""; let total = 0;
            if(cart.length===0) list.innerHTML = "<div class='text-center py-10'><i class='fa-solid fa-bag-shopping text-3xl text-slate-200 mb-2'></i><p class='text-slate-400 text-sm'>Bag is empty</p></div>";
            cart.forEach((item, i) => {
                total += Number(item.Price||item.price);
                list.innerHTML += `<div class="flex gap-3 bg-white border border-slate-100 p-3 rounded-xl relative"><img src="${item.Image||item.image}" class="w-16 h-16 object-contain bg-slate-50 rounded-lg"><div class="flex-1"><h4 class="text-xs font-bold text-slate-800 line-clamp-1">${item.Name||item.name}</h4><p class="text-[10px] text-slate-500 mb-1">Size: ${item.size}</p><p class="text-sm font-bold text-primary">₹${item.Price||item.price}</p></div><button onclick="cart.splice(${i},1); localStorage.setItem('bs_cart', JSON.stringify(cart)); updateCart();" class="absolute top-3 right-3 text-slate-300 hover:text-red-500"><i class="fa-solid fa-trash"></i></button></div>`;
            });
            document.getElementById('sub-total').innerText = total; document.getElementById('discount-val').innerText = discount;
            document.getElementById('total-price').innerText = total - discount;
        }

        function applyCoupon() {
            const code = document.getElementById('coupon-code').value.toUpperCase();
            const sub = Number(document.getElementById('sub-total').innerText);
            if(code === "BSMART10") { discount = Math.floor(sub * 0.10); showToast("Coupon Applied!"); } else { discount = 0; showToast("Invalid Coupon"); }
            updateCart();
        }

        function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('hidden'); }
        function toggleQR(show) { 
            const box = document.getElementById('qr-box');
            if(show) {
                const total = document.getElementById('total-price').innerText;
                document.getElementById('qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=${UPI_ID}&pn=${UPI_NAME}&am=${total}&cu=INR`;
                box.classList.remove('hidden');
            } else { box.classList.add('hidden'); }
        }

        // DIRECT BUY
        function buyNow() {
            if(!current) return;
            cart = [{...current, size: size||'Std'}]; // Override cart for direct buy
            localStorage.setItem('bs_cart', JSON.stringify(cart));
            updateCart();
            closeDetails();
            toggleCart();
        }

        function placeOrder() {
            if(cart.length===0) return showToast("Bag is empty");
            const name = document.getElementById('co-name').value;
            const phone = document.getElementById('co-phone').value;
            const addr = document.getElementById('co-addr').value;
            const pay = document.querySelector('input[name="payment"]:checked').value;

            if(!name || !phone || !addr) return showToast("Fill details");
            
            const btn = document.getElementById('order-btn'); btn.innerText = "Processing..."; btn.disabled = true;
            let summary = ""; cart.forEach(i => summary += `${i.Name||i.name}, `);
            const total = document.getElementById('total-price').innerText;
            const orderId = "BS" + Math.floor(100000 + Math.random() * 900000);
            const date = new Date().toLocaleDateString();

            const newOrder = { 
                id: orderId,
                date: date, 
                timestamp: new Date().getTime(),
                items: summary, 
                total: total, 
                status: "Processing" 
            };
            orderHistory.push(newOrder); localStorage.setItem('bs_orders', JSON.stringify(orderHistory));

            let items = ""; cart.forEach(i => items += `${i.Name||i.name} (${i.size}) - ₹${i.Price||i.price}\n`);
            const msg = `NEW ORDER (${pay})\nOrder ID: ${orderId}\nName: ${name}\nPhone: ${phone}\nAddr: ${addr}\nTotal: ₹${total}\nItems:\n${items}`;
            const fd = new FormData(); fd.append("_captcha", "false"); fd.append("_subject", "New Order " + orderId); fd.append("Details", msg);
            fetch("https://formsubmit.co/suheemsuheem752@gmail.com", { method: "POST", body: fd });

            // SHOW INVOICE
            document.getElementById('inv-id').innerText = "#" + orderId;
            document.getElementById('inv-date').innerText = date;
            document.getElementById('inv-total').innerText = "₹" + total;
            document.getElementById('cart-sidebar').classList.add('hidden');
            document.getElementById('invoice-modal').classList.remove('hidden');

            cart=[]; discount=0; localStorage.setItem('bs_cart', JSON.stringify(cart)); updateCart();
            btn.innerText = "Place Order"; btn.disabled = false;
        }

        function closeInvoice() { document.getElementById('invoice-modal').classList.add('hidden'); }

        // FAKE TRACKING
        function openAccount() {
            document.getElementById('acc-name').innerText = localStorage.getItem('bs_user');
            document.getElementById('acc-phone').innerText = localStorage.getItem('bs_phone');
            const list = document.getElementById('order-history-list'); list.innerHTML = "";
            if(orderHistory.length === 0) list.innerHTML = "<p class='text-center text-slate-400 text-xs mt-4'>No orders</p>";
            
            orderHistory.slice().reverse().forEach(o => {
                const days = (new Date().getTime() - (o.timestamp || new Date().getTime())) / (1000 * 60 * 60 * 24);
                let progress = 10, status = "Ordered";
                if(days > 2) { progress = 40; status = "Shipped"; }
                if(days > 10) { progress = 80; status = "Out for Delivery"; }
                if(days > 12) { progress = 100; status = "Delivered"; }

                list.innerHTML += `
                    <div class="bg-surface border border-slate-100 p-4 rounded-xl mb-3">
                        <div class="flex justify-between mb-2">
                            <span class="text-xs font-bold text-slate-800">#${o.id || 'ORDER'}</span>
                            <span class="text-[10px] text-slate-400">${o.date}</span>
                        </div>
                        <p class="text-xs font-bold text-slate-800 line-clamp-1 mb-2">${o.items}</p>
                        
                        <div class="relative w-full h-1.5 bg-slate-200 rounded-full mb-2">
                            <div class="absolute top-0 left-0 h-1.5 bg-success rounded-full" style="width: ${progress}%"></div>
                        </div>
                        <div class="flex justify-between text-[10px] mb-2">
                            <span class="font-bold text-success">${status}</span>
                            <span class="text-slate-400">Est: 12 Days</span>
                        </div>

                        <div class="flex justify-between items-center text-xs border-t pt-2">
                            <span class="text-slate-500">Total</span>
                            <span class="font-bold text-primary text-sm">₹${o.total}</span>
                        </div>
                    </div>`;
            });
            document.getElementById('account-sidebar').classList.remove('hidden');
        }
        function toggleAccount() { document.getElementById('account-sidebar').classList.add('hidden'); }
        function openSupport() { window.open("https://wa.me/919596095592", "_blank"); }
        function showToast(msg) { const t = document.getElementById("toast"); t.className = "toast show"; t.innerText = msg; setTimeout(() => t.className = t.className.replace("show", ""), 3000); }
        let taps = 0; function adminTrigger() { taps++; if(taps === 5) { if(prompt("Pass") === "admin123") document.getElementById('admin-panel').classList.remove('hidden'); taps = 0; } }
        function uploadProduct() {
            const btn = document.getElementById('upload-btn'); const file = document.getElementById('a-file').files[0];
            if(!file) return alert("Image Required"); btn.innerText = "Saving...";
            const reader = new FileReader(); reader.onload = function(e) {
                const payload = { action:"add", name:document.getElementById('a-name').value, price:document.getElementById('a-price').value, old_price:document.getElementById('a-old').value, category:document.getElementById('a-cat').value, description:document.getElementById('a-desc').value, image:e.target.result };
                fetch(API_URL, { method:"POST", mode:"no-cors", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload) }).then(()=>{ alert("Added!"); location.reload(); });
            }; reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
