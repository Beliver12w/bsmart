        </div>

    <div id="cart-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex justify-end">
        <div class="bg-white w-full md:w-96 h-full shadow-2xl flex flex-col">
            <div class="bg-[#232f3e] text-white p-4 flex justify-between items-center">
                <h2 class="font-bold">Your Cart</h2>
                <button onclick="toggleCart()"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div id="cart-items-container" class="flex-1 overflow-y-auto p-3 space-y-3 bg-gray-100"></div>
            <div class="p-3 bg-white border-t">
                <textarea id="delivery-address" class="w-full border p-2 text-sm rounded mb-2" rows="2" placeholder="House No, Street, City..."></textarea>
                <div class="flex justify-between font-bold text-xl mb-2 text-[#B12704]"><span>Total:</span><span>₹<span id="cart-total">0</span></span></div>
                <button onclick="checkoutCart()" id="buy-btn" class="w-full btn-amazon py-3 rounded shadow">Place Order</button>
            </div>
        </div>
    </div>

    <div id="admin-panel" class="fixed inset-0 bg-black bg-opacity-80 z-[90] hidden flex items-center justify-center">
        <div class="bg-white p-6 rounded w-80 max-h-[80vh] overflow-y-auto">
            <h3 class="font-bold text-lg mb-3">Admin: Add Product</h3>
            <form onsubmit="event.preventDefault(); uploadProduct();" class="space-y-2">
                <input type="text" id="a-name" placeholder="Product Title" class="w-full border p-2 rounded text-sm">
                <div class="flex gap-2">
                    <input type="number" id="a-price" placeholder="Price (₹)" class="w-full border p-2 rounded text-sm">
                    <input type="number" id="a-old-price" placeholder="MRP (Old)" class="w-full border p-2 rounded text-sm bg-orange-50">
                </div>
                <select id="a-cat" class="w-full border p-2 rounded text-sm">
                    <option value="Mens Wear">Mens Wear</option>
                    <option value="Womens">Womens</option>
                    <option value="Electronics">Electronics</option>
                </select>
                <textarea id="a-desc" placeholder="Product Description..." class="w-full border p-2 rounded text-sm"></textarea>
                <p class="text-xs font-bold">Image (Upload from Phone)</p>
                <input type="file" id="a-img" class="w-full text-xs">
                <button type="submit" id="upload-btn" class="w-full bg-[#232f3e] text-white py-2 rounded mt-2">Add Product</button>
                <button type="button" onclick="document.getElementById('admin-panel').classList.add('hidden')" class="w-full text-gray-500 mt-2 text-sm">Close</button>
            </form>
        </div>
    </div>

    <div id="invoice-modal" class="fixed inset-0 bg-black bg-opacity-80 z-[80] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-6 text-center rounded">
            <i class="fa-solid fa-check-circle text-green-500 text-5xl mb-3"></i>
            <h3 class="font-bold text-xl mb-2">Order Placed!</h3>
            <button onclick="location.reload()" class="w-full btn-amazon py-3 rounded font-bold">Continue Shopping</button>
        </div>
    </div>

    <script>
        // --- LOGIC ---
        window.onload = function() {
            if (localStorage.getItem('bsmart_username')) {
                document.getElementById('login-gate').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('nav-user').innerText = localStorage.getItem('bsmart_username');
            } else {
                document.getElementById('login-gate').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        };

        function directLogin() {
            const name = document.getElementById('gate-name').value;
            const phone = document.getElementById('gate-phone').value;
            if(name.length < 3 || phone.length < 10) return alert("Enter valid details");
            localStorage.setItem('bsmart_username', name);
            localStorage.setItem('bsmart_phone', phone);
            
            // Email Notification
            const fd = new FormData();
            fd.append("_captcha", "false"); fd.append("_subject", "New Customer Login");
            fd.append("Details", `${name} - ${phone}`);
            fetch("https://formsubmit.co/suheemsuheem752@gmail.com", { method: "POST", body: fd });

            document.getElementById('login-gate').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('nav-user').innerText = name;
        }

        // --- PRODUCTS & DISCOUNT LOGIC ---
        let allProducts = [], cart = JSON.parse(localStorage.getItem('bsmart_cart')) || [], currentProduct = null, selectedSize = null;
        const API_URL = "https://script.google.com/macros/s/AKfycby7FbnXt9tqKFK_OfuUd7dVwdSmYunenmvLJGY9yGmpHUI2NDDzPXPIYnDhfHRiP_2q/exec";

        fetch(API_URL).then(res => res.json()).then(data => { allProducts = data; document.getElementById('loading').style.display = 'none'; renderGrid(data); updateCartUI(); });

        function getOldPrice(p) { return p.Old_Price || p["Old Price"] || p.MRP || 0; }

        function renderGrid(products) {
            const grid = document.getElementById('product-grid'); grid.innerHTML = "";
            products.forEach((p, i) => {
                const price = Number(p.Price || p.price);
                const oldPrice = Number(getOldPrice(p));
                
                let discountHTML = "", oldPriceHTML = "";
                if (oldPrice > price) {
                    const percent = Math.floor(((oldPrice - price) / oldPrice) * 100);
                    discountHTML = `<span class="absolute top-2 left-2 bg-[#cc0c39] text-white text-[10px] font-bold px-2 py-1 rounded-sm">${percent}% off</span>`;
                    oldPriceHTML = `<span class="text-xs text-gray-500 line-through ml-1">₹${oldPrice}</span>`;
                }

                grid.innerHTML += `
                    <div onclick="openProduct(${i})" class="bg-white p-2 border border-gray-200 cursor-pointer h-64 flex flex-col justify-between relative">
                        ${discountHTML}
                        <div class="h-32 flex justify-center items-center"><img src="${p.Image || p.image}" class="h-full object-contain"></div>
                        <h3 class="text-xs line-clamp-2 hover:text-[#e77600]">${p.Name || p.name}</h3>
                        <div class="flex items-baseline">
                            <span class="font-bold text-lg">₹${price}</span>
                            ${oldPriceHTML}
                        </div>
                    </div>`;
            });
        }

        function openProduct(i) {
            currentProduct = allProducts[i];
            const price = Number(currentProduct.Price || currentProduct.price);
            const oldPrice = Number(getOldPrice(currentProduct));

            document.getElementById('pp-img').src = currentProduct.Image || currentProduct.image;
            document.getElementById('pp-title').innerText = currentProduct.Name || currentProduct.name;
            document.getElementById('pp-price').innerText = price;
            // Restore Description
            document.getElementById('pp-desc').innerText = currentProduct.Description || currentProduct.description || "No description available for this product.";
            
            if (oldPrice > price) {
                const percent = Math.floor(((oldPrice - price) / oldPrice) * 100);
                document.getElementById('pp-badge').innerText = `${percent}% OFF`;
                document.getElementById('pp-badge').classList.remove('hidden');
                document.getElementById('pp-discount-text').innerText = `-${percent}%`;
                document.getElementById('pp-discount-text').classList.remove('hidden');
                document.getElementById('pp-old-price').innerText = "₹" + oldPrice;
                document.getElementById('pp-mrp-block').classList.remove('hidden');
            } else {
                document.getElementById('pp-badge').classList.add('hidden');
                document.getElementById('pp-discount-text').classList.add('hidden');
                document.getElementById('pp-mrp-block').classList.add('hidden');
            }
            document.getElementById('product-page').classList.remove('hidden');
        }

        function addToCartCurrent() {
            if(!currentProduct) return;
            cart.push({ name: currentProduct.Name || currentProduct.name, price: currentProduct.Price || currentProduct.price, image: currentProduct.Image || currentProduct.image, size: selectedSize || "Std" });
            localStorage.setItem('bsmart_cart', JSON.stringify(cart));
            updateCartUI(); alert("Added to Cart"); document.getElementById('product-page').classList.add('hidden');
        }

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.length;
            const con = document.getElementById('cart-items-container'); con.innerHTML = "";
            let total = 0;
            cart.forEach((item, i) => {
                total += Number(item.price);
                con.innerHTML += `<div class="flex gap-2 bg-white p-2 border mb-1"><img src="${item.image}" class="w-10 h-10 object-contain"><div><div class="text-xs font-bold line-clamp-1">${item.name}</div><div class="text-[#B12704] font-bold">₹${item.price}</div></div><button onclick="cart.splice(${i},1); localStorage.setItem('bsmart_cart', JSON.stringify(cart)); updateCartUI()" class="text-xs ml-auto text-gray-400">Delete</button></div>`;
            });
            document.getElementById('cart-total').innerText = total;
        }

        function checkoutCart() {
            if(cart.length===0) return alert("Empty Cart");
            const address = document.getElementById('delivery-address').value;
            if(address.length < 5) return alert("Enter Address");
            const btn = document.getElementById('buy-btn'); btn.innerText = "Processing..."; btn.disabled = true;

            const name = localStorage.getItem('bsmart_username');
            const phone = localStorage.getItem('bsmart_phone');
            let items = ""; cart.forEach(i => { items += `${i.name} (Size: ${i.size}) - ₹${i.price}\n`; });

            const fd = new FormData();
            fd.append("_captcha", "false"); fd.append("_subject", "NEW ORDER: " + name);
            fd.append("Details", `Customer: ${name} (${phone})\nAddress: ${address}\nTotal: ₹${document.getElementById('cart-total').innerText}\nItems:\n${items}`);

            fetch("https://formsubmit.co/suheemsuheem752@gmail.com", { method: "POST", body: fd })
                .then(() => { cart = []; localStorage.setItem('bsmart_cart', JSON.stringify(cart)); updateCartUI(); document.getElementById('cart-sidebar').classList.add('hidden'); document.getElementById('invoice-modal').classList.remove('hidden'); })
                .finally(() => { btn.innerText = "Place Order"; btn.disabled = false; });
        }

        // --- ADMIN PANEL LOGIC ---
        let taps = 0;
        function adminLoginTrigger() {
            taps++;
            if(taps === 5) {
                const pass = prompt("Enter Admin Password:");
                if(pass === "admin123") {
                    document.getElementById('admin-panel').classList.remove('hidden');
                } else {
                    alert("Wrong Password");
                }
                taps = 0;
            }
        }

        function uploadProduct() {
            const btn = document.getElementById('upload-btn');
            const file = document.getElementById('a-img').files[0];
            if(!file) return alert("Select Image");
            btn.innerText = "Saving...";
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const payload = { 
                    action: "add", 
                    name: document.getElementById('a-name').value, 
                    price: document.getElementById('a-price').value, 
                    old_price: document.getElementById('a-old-price').value, 
                    category: document.getElementById('a-cat').value, 
                    image: e.target.result, 
                    description: document.getElementById('a-desc').value 
                };
                
                fetch(API_URL, { 
                    method: "POST", 
                    mode: "no-cors", 
                    headers: {"Content-Type": "application/json"}, 
                    body: JSON.stringify(payload) 
                }).then(() => { 
                    alert("Product Added!"); 
                    location.reload(); 
                });
            };
            reader.readAsDataURL(file);
        }

        function closeProductPage() { document.getElementById('product-page').classList.add('hidden'); }
        function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('hidden'); }
        function selectSize(btn, s) { selectedSize = s; document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('bg-yellow-400')); btn.classList.add('bg-yellow-400'); }
        function searchProducts() { const q = document.getElementById('search').value.toLowerCase(); renderGrid(allProducts.filter(p => (p.Name||p.name).toLowerCase().includes(q))); }
    </script>
</body>
</html>

