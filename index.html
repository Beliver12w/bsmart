<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS MART | Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Smooth scrolling and animations */
        html { scroll-behavior: smooth; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Hide scrollbar for category list */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen relative pb-20">

    <div id="admin-panel" class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden flex items-center justify-center fade-in">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md m-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Add Product</h2>
                <button onclick="toggleElement('admin-panel')" class="text-gray-500 hover:text-red-500"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            
            <form onsubmit="addProduct(event)" class="space-y-3">
                <input type="text" id="p-name" required class="w-full border p-2 rounded" placeholder="Product Name">
                <textarea id="p-desc" class="w-full border p-2 rounded" placeholder="Product Description (e.g. Cotton fabric, fast color)"></textarea>
                
                <div class="grid grid-cols-2 gap-3">
                    <input type="number" id="p-price" required class="w-full border p-2 rounded" placeholder="Sale Price (â‚¹)">
                    <input type="number" id="p-old-price" class="w-full border p-2 rounded bg-gray-50" placeholder="MRP / Old Price (â‚¹)">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <input type="number" id="p-rating" step="0.1" max="5" class="w-full border p-2 rounded" placeholder="Rating (4.5)">
                    <select id="p-category" class="w-full border p-2 rounded">
                        <option value="Mens Wear">Mens Wear</option>
                        <option value="Womens">Womens</option>
                        <option value="Kids">Kids</option>
                        <option value="Electronics">Electronics</option>
                    </select>
                </div>

                <div class="border-2 border-dashed border-gray-300 p-4 rounded text-center">
                    <p class="text-sm text-gray-500 mb-2">Choose Image</p>
                    <input type="file" id="p-image-file" accept="image/*" required class="w-full text-sm text-gray-500"/>
                </div>
                <button type="submit" id="add-btn" class="w-full bg-pink-600 text-white py-2 rounded font-bold hover:bg-pink-700">Upload</button>
            </form>
        </div>
    </div>

    <div id="product-modal" class="fixed inset-0 bg-white z-[60] hidden overflow-y-auto fade-in">
        <div class="max-w-md mx-auto bg-white min-h-screen shadow-2xl relative">
            <button onclick="toggleElement('product-modal')" class="absolute top-4 left-4 z-10 bg-white/80 p-2 rounded-full shadow hover:bg-white">
                <i class="fa-solid fa-arrow-left text-gray-700"></i>
            </button>

            <div class="h-80 bg-gray-100 flex items-center justify-center">
                <img id="detail-img" src="" class="max-h-full max-w-full object-contain">
            </div>

            <div class="p-4 pb-24">
                <h1 id="detail-name" class="text-xl font-bold text-gray-800"></h1>
                
                <div class="flex items-center gap-3 mt-2">
                    <p id="detail-price" class="text-2xl font-bold text-pink-600"></p>
                    <p id="detail-old-price" class="text-lg text-gray-400 line-through hidden"></p>
                    <span id="detail-discount" class="bg-red-100 text-red-600 px-2 py-1 rounded text-xs font-bold hidden"></span>
                </div>
                
                <div class="mt-4 p-3 bg-green-50 rounded border border-green-100 flex items-center gap-2">
                    <i class="fa-solid fa-truck-fast text-green-600"></i>
                    <span class="text-sm text-green-700 font-medium">Free Delivery</span>
                </div>

                <div class="mt-6">
                    <h3 class="font-bold text-gray-700 mb-2">Select Size</h3>
                    <div class="flex gap-3" id="size-options">
                        <label class="cursor-pointer"><input type="radio" name="size" value="S" class="peer sr-only"><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">S</span></label>
                        <label class="cursor-pointer"><input type="radio" name="size" value="M" class="peer sr-only" checked><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">M</span></label>
                        <label class="cursor-pointer"><input type="radio" name="size" value="L" class="peer sr-only"><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">L</span></label>
                        <label class="cursor-pointer"><input type="radio" name="size" value="XL" class="peer sr-only"><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">XL</span></label>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="font-bold text-gray-700 mb-1">Product Details</h3>
                    <p id="detail-desc" class="text-gray-500 text-sm leading-relaxed"></p>
                </div>
            </div>

            <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto p-4 bg-white border-t shadow-lg">
                <button onclick="openCheckout()" class="w-full bg-pink-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-pink-700 shadow-lg shadow-pink-200">
                    Buy Now
                </button>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[70] hidden flex items-end sm:items-center justify-center fade-in">
        <div class="bg-white w-full sm:w-96 p-6 rounded-t-2xl sm:rounded-2xl shadow-2xl relative">
            <button onclick="toggleElement('checkout-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-black">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
            
            <h2 class="text-xl font-bold mb-4">Checkout</h2>
            
            <form onsubmit="placeOrder(event)" class="space-y-4">
                <input type="text" id="cust-name" required class="w-full border-b-2 border-gray-200 p-2 focus:border-pink-600 outline-none transition" placeholder="Full Name">
                <input type="tel" id="cust-phone" required class="w-full border-b-2 border-gray-200 p-2 focus:border-pink-600 outline-none transition" placeholder="Phone Number">
                <textarea id="cust-addr" required class="w-full border-b-2 border-gray-200 p-2 focus:border-pink-600 outline-none transition" placeholder="Full Address (House No, Area, City, Pin Code)"></textarea>
                
                <div class="mt-4">
                    <p class="font-bold text-sm mb-2 text-gray-600">Payment Method</p>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment" value="Cash on Delivery" checked class="text-pink-600 focus:ring-pink-500">
                            <span class="font-medium"><i class="fa-solid fa-money-bill-wave text-green-600 mr-2"></i>Cash on Delivery</span>
                        </label>
                        <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment" value="Online Payment" class="text-pink-600 focus:ring-pink-500">
                            <span class="font-medium"><i class="fa-brands fa-google-pay text-blue-600 mr-2"></i>Online Payment (UPI)</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold mt-4 hover:bg-green-700 shadow-lg shadow-green-200">
                    <i class="fa-brands fa-whatsapp mr-2"></i> Place Order on WhatsApp
                </button>
            </form>
        </div>
    </div>

    <nav class="bg-white shadow sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 onclick="secretLogin()" class="text-2xl font-bold text-pink-600 cursor-pointer select-none active:scale-95 transition">
                BS MART
            </h1>
            <div class="text-[10px] text-gray-300 select-none">...</div>
        </div>
        <div class="bg-pink-50 py-2 overflow-x-auto no-scrollbar">
            <div class="flex justify-start md:justify-center space-x-2 px-4 min-w-max">
                <button onclick="filterCategory('All')" class="cat-btn bg-pink-600 text-white px-4 py-1.5 rounded-full text-sm font-medium transition shadow">All</button>
                <button onclick="filterCategory('Mens Wear')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Mens Wear</button>
                <button onclick="filterCategory('Womens')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Womens</button>
                <button onclick="filterCategory('Kids')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Kids</button>
                <button onclick="filterCategory('Electronics')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Electronics</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <div id="loading" class="text-center py-20">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-pink-300"></i>
            <p class="mt-2 text-gray-500">Loading Products...</p>
        </div>
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </main>

    <script>
        // âœ… YOUR WHATSAPP NUMBER
        const YOUR_WHATSAPP_NUMBER = '919596095592'; 

        // âœ… YOUR API LINK
        const API_URL = 'https://script.google.com/macros/s/AKfycby7FbnXt9tqKFK_OfuUd7dVwdSmYunenmvLJGY9yGmpHUI2NDDzPXPIYnDhfHRiP_2q/exec'; 

        let inventory = [];
        let currentProduct = {}; 
        let currentDisplayList = []; 
        let isAdmin = false;

        // --- FETCH DATA ---
        async function fetchProducts() {
            try {
                const res = await fetch(API_URL);
                inventory = await res.json();
                document.getElementById('loading').classList.add('hidden');
                filterCategory('All'); 
            } catch (e) { console.error(e); }
        }

        // --- SMART HELPER ---
        function getSafeValue(item, key) {
            return item[key] || item[key.toLowerCase()] || item[key.toUpperCase()] || item[key + ' '];
        }

        // --- RENDER GRID WITH DISCOUNT ---
        function renderProducts(data) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            
            if(data.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-10 text-gray-500">No products found.</div>';
                return;
            }

            data.forEach((item, index) => {
                const name = getSafeValue(item, 'Name') || 'Product';
                const price = getSafeValue(item, 'Price') || '0';
                
                // 1. GET OLD PRICE
                const oldPrice = item['Old_Price'] || item['Old Price'] || ''; 
                
                const image = getSafeValue(item, 'Image_URL') || getSafeValue(item, 'Image-URL'); 
                const rating = getSafeValue(item, 'Rating') || 4.5;

                // 2. CALCULATE DISCOUNT
                let discountTag = '';
                let oldPriceDisplay = '';

                if(oldPrice && Number(oldPrice) > Number(price)) {
                    const off = Math.round(((oldPrice - price) / oldPrice) * 100);
                    discountTag = `<span class="absolute top-2 left-2 bg-red-500 text-white text-[10px] px-2 py-0.5 rounded font-bold z-10">${off}% OFF</span>`;
                    oldPriceDisplay = `<span class="text-xs text-gray-400 line-through">â‚¹${oldPrice}</span>`;
                }

                // 3. ADMIN BUTTONS (Visible only if secret login used)
                const adminButtons = isAdmin ? `
                    <div class="absolute top-2 right-2 flex gap-2 z-20">
                        <button onclick="event.stopPropagation(); alert('Use Google Sheet to Edit')" class="bg-blue-500 text-white w-7 h-7 rounded-full shadow hover:bg-blue-600 flex items-center justify-center"><i class="fa-solid fa-pen text-xs"></i></button>
                        <button onclick="event.stopPropagation(); deleteProduct(this)" class="bg-red-500 text-white w-7 h-7 rounded-full shadow hover:bg-red-600 flex items-center justify-center"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>
                ` : '';

                // 4. STARS
                let stars = '';
                for(let i=1; i<=5; i++) stars += i<=rating ? '<i class="fa-solid fa-star text-yellow-400 text-[10px]"></i>' : '<i class="fa-regular fa-star text-gray-300 text-[10px]"></i>';

                // 5. CREATE CARD
                grid.innerHTML += `
                    <div onclick="openProductDetail(${index})" class="bg-white p-3 rounded-lg shadow-sm border border-gray-100 hover:shadow-lg transition cursor-pointer relative group">
                        ${discountTag}
                        ${adminButtons}
                        <div class="h-40 flex items-center justify-center bg-gray-50 rounded mb-2 overflow-hidden relative">
                            <img src="${image}" class="max-h-full max-w-full object-contain group-hover:scale-105 transition duration-300">
                        </div>
                        <h3 class="font-bold text-sm truncate text-gray-800">${name}</h3>
                        <div class="flex items-center gap-1 mt-1 mb-2">
                            <div class="flex">${stars}</div>
                            <span class="text-[10px] text-gray-400">(${Math.floor(Math.random()*50)+5})</span>
                        </div>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-pink-600 font-bold">â‚¹${price}</span>
                            ${oldPriceDisplay}
                        </div>
                    </div>
                `;
            });
        }

        // --- FILTER ---
        function filterCategory(cat) {
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.className = (btn.innerText === cat) 
                    ? "cat-btn bg-pink-600 text-white px-4 py-1.5 rounded-full text-sm font-medium transition shadow-md"
                    : "cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border";
            });

            if (cat === 'All') {
                currentDisplayList = inventory;
            } else {
                currentDisplayList = inventory.filter(i => {
                    const itemCat = getSafeValue(i, 'Category');
                    return itemCat && itemCat.trim() === cat;
                });
            }
            renderProducts(currentDisplayList);
        }

        // --- OPEN PRODUCT DETAIL WITH DISCOUNT ---
        function openProductDetail(index) {
            const item = currentDisplayList[index]; 
            currentProduct = item; 

            const name = getSafeValue(item, 'Name');
            const price = getSafeValue(item, 'Price');
            
            // 1. GET OLD PRICE
            const oldPrice = item['Old_Price'] || item['Old Price'] || ''; 
            
            const image = getSafeValue(item, 'Image_URL') || getSafeValue(item, 'Image-URL'); 
            const desc = getSafeValue(item, 'Description') || "High quality product. Best fabric and comfortable fit."; 

            document.getElementById('detail-img').src = image;
            document.getElementById('detail-name').innerText = name;
            document.getElementById('detail-price').innerText = "â‚¹" + price;
            document.getElementById('detail-desc').innerText = desc;
            
            // 2. HANDLE DISCOUNT DISPLAY IN POPUP
            const oldPriceEl = document.getElementById('detail-old-price');
            const discountEl = document.getElementById('detail-discount');
            
            if(oldPrice && Number(oldPrice) > Number(price)) {
                oldPriceEl.innerText = "â‚¹" + oldPrice;
                oldPriceEl.classList.remove('hidden');
                
                const off = Math.round(((oldPrice - price) / oldPrice) * 100);
                discountEl.innerText = off + "% OFF";
                discountEl.classList.remove('hidden');
            } else {
                oldPriceEl.classList.add('hidden');
                discountEl.classList.add('hidden');
            }

            toggleElement('product-modal');
        }

        // --- CHECKOUT ---
        function openCheckout() {
            toggleElement('checkout-modal');
        }

        function placeOrder(e) {
            e.preventDefault();
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const address = document.getElementById('cust-addr').value;
            const payment = document.querySelector('input[name="payment"]:checked').value;
            const size = document.querySelector('input[name="size"]:checked').value;
            
            const prodName = getSafeValue(currentProduct, 'Name');
            const prodPrice = getSafeValue(currentProduct, 'Price');

            const message = `*NEW ORDER FROM BS MART* ðŸ›ï¸%0A%0A` +
                            `*Product:* ${prodName}%0A` +
                            `*Price:* â‚¹${prodPrice}%0A` +
                            `*Size:* ${size}%0A` +
                            `-------------------------%0A` +
                            `*Customer:* ${name}%0A` +
                            `*Phone:* ${phone}%0A` +
                            `*Address:* ${address}%0A` +
                            `*Payment:* ${payment}%0A` +
                            `-------------------------%0A` +
                            `Please confirm my order!`;

            window.open(`https://wa.me/${YOUR_WHATSAPP_NUMBER}?text=${message}`, '_blank');
            toggleElement('checkout-modal');
            toggleElement('product-modal');
        }

        // --- UTILS ---
        function toggleElement(id) {
            const el = document.getElementById(id);
            el.classList.toggle('hidden');
        }

        // --- ADMIN UPLOAD & LOGIN ---
        let clickCount = 0;
        function secretLogin() {
            clickCount++;
            if (clickCount === 3) {
                if (prompt("Admin Password:") === "admin123") {
                    isAdmin = true;
                    toggleElement('admin-panel');
                    filterCategory('All'); // Refresh to show delete buttons
                }
                clickCount = 0;
            }
        }
        
        function deleteProduct(btn) {
            if(confirm("This removes it from screen. To delete permanently, remove row from Google Sheet.")) {
                btn.closest('.bg-white').remove();
            }
        }

        async function addProduct(e) {
            e.preventDefault();
            const btn = document.getElementById('add-btn');
            const fileInput = document.getElementById('p-image-file');
            
            if(fileInput.files.length === 0) return alert("Select an image");
            btn.innerText = "Processing..."; btn.disabled = true;

            const base64Image = await compressImage(fileInput.files[0]);

            const productData = {
                action: 'add',
                name: document.getElementById('p-name').value,
                price: document.getElementById('p-price').value,
                
                // âœ… SAVES OLD PRICE TO GOOGLE SHEET
                old_price: document.getElementById('p-old-price').value, 
                
                rating: document.getElementById('p-rating').value || 4.5,
                category: document.getElementById('p-category').value,
                description: document.getElementById('p-desc').value || "Best quality product.", 
                image: base64Image
            };

            try {
                await fetch(API_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'text/plain;charset=utf-8'}, body: JSON.stringify(productData)});
                alert("Saved! Refreshing..."); toggleElement('admin-panel'); e.target.reset(); setTimeout(fetchProducts, 3000);
            } catch (err) { alert("Error uploading."); }
            btn.innerText = "Upload"; btn.disabled = false;
        }

        function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (ev) => {
                    const img = new Image(); img.src = ev.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const scale = 400 / img.width;
                        canvas.width = 400; canvas.height = img.height * scale;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6)); 
                    }
                }
            });
        }

        fetchProducts();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS MART | Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Smooth scrolling and animations */
        html { scroll-behavior: smooth; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Hide scrollbar for category list */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen relative pb-20">

    <div id="admin-panel" class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden flex items-center justify-center fade-in">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md m-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Add Product</h2>
                <button onclick="toggleElement('admin-panel')" class="text-gray-500 hover:text-red-500"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            
            <form onsubmit="addProduct(event)" class="space-y-3">
                <input type="text" id="p-name" required class="w-full border p-2 rounded" placeholder="Product Name">
                <textarea id="p-desc" class="w-full border p-2 rounded" placeholder="Product Description (e.g. Cotton fabric, fast color)"></textarea>
                
                <div class="grid grid-cols-2 gap-3">
                    <input type="number" id="p-price" required class="w-full border p-2 rounded" placeholder="Sale Price (â‚¹)">
                    <input type="number" id="p-old-price" class="w-full border p-2 rounded bg-gray-50" placeholder="MRP / Old Price (â‚¹)">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <input type="number" id="p-rating" step="0.1" max="5" class="w-full border p-2 rounded" placeholder="Rating (4.5)">
                    <select id="p-category" class="w-full border p-2 rounded">
                        <option value="Mens Wear">Mens Wear</option>
                        <option value="Womens">Womens</option>
                        <option value="Kids">Kids</option>
                        <option value="Electronics">Electronics</option>
                    </select>
                </div>

                <div class="border-2 border-dashed border-gray-300 p-4 rounded text-center">
                    <p class="text-sm text-gray-500 mb-2">Choose Image</p>
                    <input type="file" id="p-image-file" accept="image/*" required class="w-full text-sm text-gray-500"/>
                </div>
                <button type="submit" id="add-btn" class="w-full bg-pink-600 text-white py-2 rounded font-bold hover:bg-pink-700">Upload</button>
            </form>
        </div>
    </div>

    <div id="product-modal" class="fixed inset-0 bg-white z-[60] hidden overflow-y-auto fade-in">
        <div class="max-w-md mx-auto bg-white min-h-screen shadow-2xl relative">
            <button onclick="toggleElement('product-modal')" class="absolute top-4 left-4 z-10 bg-white/80 p-2 rounded-full shadow hover:bg-white">
                <i class="fa-solid fa-arrow-left text-gray-700"></i>
            </button>

            <div class="h-80 bg-gray-100 flex items-center justify-center">
                <img id="detail-img" src="" class="max-h-full max-w-full object-contain">
            </div>

            <div class="p-4 pb-24">
                <h1 id="detail-name" class="text-xl font-bold text-gray-800"></h1>
                
                <div class="flex items-center gap-3 mt-2">
                    <p id="detail-price" class="text-2xl font-bold text-pink-600"></p>
                    <p id="detail-old-price" class="text-lg text-gray-400 line-through hidden"></p>
                    <span id="detail-discount" class="bg-red-100 text-red-600 px-2 py-1 rounded text-xs font-bold hidden"></span>
                </div>
                
                <div class="mt-4 p-3 bg-green-50 rounded border border-green-100 flex items-center gap-2">
                    <i class="fa-solid fa-truck-fast text-green-600"></i>
                    <span class="text-sm text-green-700 font-medium">Free Delivery</span>
                </div>

                <div class="mt-6">
                    <h3 class="font-bold text-gray-700 mb-2">Select Size</h3>
                    <div class="flex gap-3" id="size-options">
                        <label class="cursor-pointer"><input type="radio" name="size" value="S" class="peer sr-only"><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">S</span></label>
                        <label class="cursor-pointer"><input type="radio" name="size" value="M" class="peer sr-only" checked><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">M</span></label>
                        <label class="cursor-pointer"><input type="radio" name="size" value="L" class="peer sr-only"><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">L</span></label>
                        <label class="cursor-pointer"><input type="radio" name="size" value="XL" class="peer sr-only"><span class="px-4 py-2 border rounded-full peer-checked:bg-pink-600 peer-checked:text-white peer-checked:border-pink-600">XL</span></label>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="font-bold text-gray-700 mb-1">Product Details</h3>
                    <p id="detail-desc" class="text-gray-500 text-sm leading-relaxed"></p>
                </div>
            </div>

            <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto p-4 bg-white border-t shadow-lg">
                <button onclick="openCheckout()" class="w-full bg-pink-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-pink-700 shadow-lg shadow-pink-200">
                    Buy Now
                </button>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[70] hidden flex items-end sm:items-center justify-center fade-in">
        <div class="bg-white w-full sm:w-96 p-6 rounded-t-2xl sm:rounded-2xl shadow-2xl relative">
            <button onclick="toggleElement('checkout-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-black">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
            
            <h2 class="text-xl font-bold mb-4">Checkout</h2>
            
            <form onsubmit="placeOrder(event)" class="space-y-4">
                <input type="text" id="cust-name" required class="w-full border-b-2 border-gray-200 p-2 focus:border-pink-600 outline-none transition" placeholder="Full Name">
                <input type="tel" id="cust-phone" required class="w-full border-b-2 border-gray-200 p-2 focus:border-pink-600 outline-none transition" placeholder="Phone Number">
                <textarea id="cust-addr" required class="w-full border-b-2 border-gray-200 p-2 focus:border-pink-600 outline-none transition" placeholder="Full Address (House No, Area, City, Pin Code)"></textarea>
                
                <div class="mt-4">
                    <p class="font-bold text-sm mb-2 text-gray-600">Payment Method</p>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment" value="Cash on Delivery" checked class="text-pink-600 focus:ring-pink-500">
                            <span class="font-medium"><i class="fa-solid fa-money-bill-wave text-green-600 mr-2"></i>Cash on Delivery</span>
                        </label>
                        <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment" value="Online Payment" class="text-pink-600 focus:ring-pink-500">
                            <span class="font-medium"><i class="fa-brands fa-google-pay text-blue-600 mr-2"></i>Online Payment (UPI)</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold mt-4 hover:bg-green-700 shadow-lg shadow-green-200">
                    <i class="fa-brands fa-whatsapp mr-2"></i> Place Order on WhatsApp
                </button>
            </form>
        </div>
    </div>

    <nav class="bg-white shadow sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 onclick="secretLogin()" class="text-2xl font-bold text-pink-600 cursor-pointer select-none active:scale-95 transition">
                BS MART
            </h1>
            <div class="text-[10px] text-gray-300 select-none">...</div>
        </div>
        <div class="bg-pink-50 py-2 overflow-x-auto no-scrollbar">
            <div class="flex justify-start md:justify-center space-x-2 px-4 min-w-max">
                <button onclick="filterCategory('All')" class="cat-btn bg-pink-600 text-white px-4 py-1.5 rounded-full text-sm font-medium transition shadow">All</button>
                <button onclick="filterCategory('Mens Wear')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Mens Wear</button>
                <button onclick="filterCategory('Womens')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Womens</button>
                <button onclick="filterCategory('Kids')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Kids</button>
                <button onclick="filterCategory('Electronics')" class="cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border">Electronics</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <div id="loading" class="text-center py-20">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-pink-300"></i>
            <p class="mt-2 text-gray-500">Loading Products...</p>
        </div>
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </main>

    <script>
        // âœ… YOUR WHATSAPP NUMBER
        const YOUR_WHATSAPP_NUMBER = '919596095592'; 

        // âœ… YOUR API LINK
        const API_URL = 'https://script.google.com/macros/s/AKfycby7FbnXt9tqKFK_OfuUd7dVwdSmYunenmvLJGY9yGmpHUI2NDDzPXPIYnDhfHRiP_2q/exec'; 

        let inventory = [];
        let currentProduct = {}; 
        let currentDisplayList = []; 
        let isAdmin = false;

        // --- FETCH DATA ---
        async function fetchProducts() {
            try {
                const res = await fetch(API_URL);
                inventory = await res.json();
                document.getElementById('loading').classList.add('hidden');
                filterCategory('All'); 
            } catch (e) { console.error(e); }
        }

        // --- SMART HELPER ---
        function getSafeValue(item, key) {
            return item[key] || item[key.toLowerCase()] || item[key.toUpperCase()] || item[key + ' '];
        }

        // --- RENDER GRID WITH DISCOUNT ---
        function renderProducts(data) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            
            if(data.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-10 text-gray-500">No products found.</div>';
                return;
            }

            data.forEach((item, index) => {
                const name = getSafeValue(item, 'Name') || 'Product';
                const price = getSafeValue(item, 'Price') || '0';
                
                // 1. GET OLD PRICE
                const oldPrice = item['Old_Price'] || item['Old Price'] || ''; 
                
                const image = getSafeValue(item, 'Image_URL') || getSafeValue(item, 'Image-URL'); 
                const rating = getSafeValue(item, 'Rating') || 4.5;

                // 2. CALCULATE DISCOUNT
                let discountTag = '';
                let oldPriceDisplay = '';

                if(oldPrice && Number(oldPrice) > Number(price)) {
                    const off = Math.round(((oldPrice - price) / oldPrice) * 100);
                    discountTag = `<span class="absolute top-2 left-2 bg-red-500 text-white text-[10px] px-2 py-0.5 rounded font-bold z-10">${off}% OFF</span>`;
                    oldPriceDisplay = `<span class="text-xs text-gray-400 line-through">â‚¹${oldPrice}</span>`;
                }

                // 3. ADMIN BUTTONS (Visible only if secret login used)
                const adminButtons = isAdmin ? `
                    <div class="absolute top-2 right-2 flex gap-2 z-20">
                        <button onclick="event.stopPropagation(); alert('Use Google Sheet to Edit')" class="bg-blue-500 text-white w-7 h-7 rounded-full shadow hover:bg-blue-600 flex items-center justify-center"><i class="fa-solid fa-pen text-xs"></i></button>
                        <button onclick="event.stopPropagation(); deleteProduct(this)" class="bg-red-500 text-white w-7 h-7 rounded-full shadow hover:bg-red-600 flex items-center justify-center"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>
                ` : '';

                // 4. STARS
                let stars = '';
                for(let i=1; i<=5; i++) stars += i<=rating ? '<i class="fa-solid fa-star text-yellow-400 text-[10px]"></i>' : '<i class="fa-regular fa-star text-gray-300 text-[10px]"></i>';

                // 5. CREATE CARD
                grid.innerHTML += `
                    <div onclick="openProductDetail(${index})" class="bg-white p-3 rounded-lg shadow-sm border border-gray-100 hover:shadow-lg transition cursor-pointer relative group">
                        ${discountTag}
                        ${adminButtons}
                        <div class="h-40 flex items-center justify-center bg-gray-50 rounded mb-2 overflow-hidden relative">
                            <img src="${image}" class="max-h-full max-w-full object-contain group-hover:scale-105 transition duration-300">
                        </div>
                        <h3 class="font-bold text-sm truncate text-gray-800">${name}</h3>
                        <div class="flex items-center gap-1 mt-1 mb-2">
                            <div class="flex">${stars}</div>
                            <span class="text-[10px] text-gray-400">(${Math.floor(Math.random()*50)+5})</span>
                        </div>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-pink-600 font-bold">â‚¹${price}</span>
                            ${oldPriceDisplay}
                        </div>
                    </div>
                `;
            });
        }

        // --- FILTER ---
        function filterCategory(cat) {
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.className = (btn.innerText === cat) 
                    ? "cat-btn bg-pink-600 text-white px-4 py-1.5 rounded-full text-sm font-medium transition shadow-md"
                    : "cat-btn bg-white text-gray-600 hover:text-pink-600 px-4 py-1.5 rounded-full text-sm font-medium transition border";
            });

            if (cat === 'All') {
                currentDisplayList = inventory;
            } else {
                currentDisplayList = inventory.filter(i => {
                    const itemCat = getSafeValue(i, 'Category');
                    return itemCat && itemCat.trim() === cat;
                });
            }
            renderProducts(currentDisplayList);
        }

        // --- OPEN PRODUCT DETAIL WITH DISCOUNT ---
        function openProductDetail(index) {
            const item = currentDisplayList[index]; 
            currentProduct = item; 

            const name = getSafeValue(item, 'Name');
            const price = getSafeValue(item, 'Price');
            
            // 1. GET OLD PRICE
            const oldPrice = item['Old_Price'] || item['Old Price'] || ''; 
            
            const image = getSafeValue(item, 'Image_URL') || getSafeValue(item, 'Image-URL'); 
            const desc = getSafeValue(item, 'Description') || "High quality product. Best fabric and comfortable fit."; 

            document.getElementById('detail-img').src = image;
            document.getElementById('detail-name').innerText = name;
            document.getElementById('detail-price').innerText = "â‚¹" + price;
            document.getElementById('detail-desc').innerText = desc;
            
            // 2. HANDLE DISCOUNT DISPLAY IN POPUP
            const oldPriceEl = document.getElementById('detail-old-price');
            const discountEl = document.getElementById('detail-discount');
            
            if(oldPrice && Number(oldPrice) > Number(price)) {
                oldPriceEl.innerText = "â‚¹" + oldPrice;
                oldPriceEl.classList.remove('hidden');
                
                const off = Math.round(((oldPrice - price) / oldPrice) * 100);
                discountEl.innerText = off + "% OFF";
                discountEl.classList.remove('hidden');
            } else {
                oldPriceEl.classList.add('hidden');
                discountEl.classList.add('hidden');
            }

            toggleElement('product-modal');
        }

        // --- CHECKOUT ---
        function openCheckout() {
            toggleElement('checkout-modal');
        }

        function placeOrder(e) {
            e.preventDefault();
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const address = document.getElementById('cust-addr').value;
            const payment = document.querySelector('input[name="payment"]:checked').value;
            const size = document.querySelector('input[name="size"]:checked').value;
            
            const prodName = getSafeValue(currentProduct, 'Name');
            const prodPrice = getSafeValue(currentProduct, 'Price');

            const message = `*NEW ORDER FROM BS MART* ðŸ›ï¸%0A%0A` +
                            `*Product:* ${prodName}%0A` +
                            `*Price:* â‚¹${prodPrice}%0A` +
                            `*Size:* ${size}%0A` +
                            `-------------------------%0A` +
                            `*Customer:* ${name}%0A` +
                            `*Phone:* ${phone}%0A` +
                            `*Address:* ${address}%0A` +
                            `*Payment:* ${payment}%0A` +
                            `-------------------------%0A` +
                            `Please confirm my order!`;

            window.open(`https://wa.me/${YOUR_WHATSAPP_NUMBER}?text=${message}`, '_blank');
            toggleElement('checkout-modal');
            toggleElement('product-modal');
        }

        // --- UTILS ---
        function toggleElement(id) {
            const el = document.getElementById(id);
            el.classList.toggle('hidden');
        }

        // --- ADMIN UPLOAD & LOGIN ---
        let clickCount = 0;
        function secretLogin() {
            clickCount++;
            if (clickCount === 3) {
                if (prompt("Admin Password:") === "admin123") {
                    isAdmin = true;
                    toggleElement('admin-panel');
                    filterCategory('All'); // Refresh to show delete buttons
                }
                clickCount = 0;
            }
        }
        
        function deleteProduct(btn) {
            if(confirm("This removes it from screen. To delete permanently, remove row from Google Sheet.")) {
                btn.closest('.bg-white').remove();
            }
        }

        async function addProduct(e) {
            e.preventDefault();
            const btn = document.getElementById('add-btn');
            const fileInput = document.getElementById('p-image-file');
            
            if(fileInput.files.length === 0) return alert("Select an image");
            btn.innerText = "Processing..."; btn.disabled = true;

            const base64Image = await compressImage(fileInput.files[0]);

            const productData = {
                action: 'add',
                name: document.getElementById('p-name').value,
                price: document.getElementById('p-price').value,
                
                // âœ… SAVES OLD PRICE TO GOOGLE SHEET
                old_price: document.getElementById('p-old-price').value, 
                
                rating: document.getElementById('p-rating').value || 4.5,
                category: document.getElementById('p-category').value,
                description: document.getElementById('p-desc').value || "Best quality product.", 
                image: base64Image
            };

            try {
                await fetch(API_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'text/plain;charset=utf-8'}, body: JSON.stringify(productData)});
                alert("Saved! Refreshing..."); toggleElement('admin-panel'); e.target.reset(); setTimeout(fetchProducts, 3000);
            } catch (err) { alert("Error uploading."); }
            btn.innerText = "Upload"; btn.disabled = false;
        }

        function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (ev) => {
                    const img = new Image(); img.src = ev.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const scale = 400 / img.width;
                        canvas.width = 400; canvas.height = img.height * scale;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6)); 
                    }
                }
            });
        }

        fetchProducts();
    </script>
</body>
</html>
