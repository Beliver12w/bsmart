<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS MART | Online Shopping</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-100 font-sans pb-24 select-none">

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby7FbnXt9tqKFK_OfuUd7dVwdSmYunenmvLJGY9yGmpHUI2NDDzPXPIYnDhfHRiP_2q/exec"; 
        const QR_CODE_IMAGE = "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=9596095592@upi&pn=BS_MART";
    </script>

    <nav class="bg-[#232f3e] text-white sticky top-0 z-50 shadow-md">
        <div class="relative flex justify-between items-center px-4 py-3">
            <button class="text-xl z-10"><i class="fa-solid fa-bars"></i></button>

            <div onclick="adminLoginTrigger()" class="absolute inset-0 flex justify-center items-center cursor-pointer z-20">
                <span class="text-xl font-bold tracking-wider select-none">BS <span class="text-[#febd69]">MART</span></span>
            </div>

            <div class="relative z-10">
                <i class="fa-solid fa-cart-shopping text-xl"></i>
                <span class="absolute -top-2 -right-2 bg-[#febd69] text-[#232f3e] text-[10px] font-bold px-1.5 py-0.5 rounded-full">0</span>
            </div>
        </div>

        <div class="px-3 pb-3">
            <div class="flex bg-white rounded-md overflow-hidden h-10">
                <input type="text" id="search" onkeyup="searchProducts()" placeholder="Search BS MART..." class="w-full px-4 text-gray-700 outline-none text-sm">
                <button onclick="searchProducts()" class="bg-[#febd69] w-12 flex justify-center items-center text-gray-800"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
        </div>

        <div class="bg-[#37475a] py-2 overflow-x-auto no-scrollbar">
            <div class="flex px-4 space-x-5 text-sm font-medium text-white min-w-max">
                <span onclick="filterProducts('All')" class="cursor-pointer hover:text-[#febd69]">All</span>
                <span onclick="filterProducts('Mens Wear')" class="cursor-pointer hover:text-[#febd69]">Men</span>
                <span onclick="filterProducts('Womens')" class="cursor-pointer hover:text-[#febd69]">Women</span>
                <span onclick="filterProducts('Electronics')" class="cursor-pointer hover:text-[#febd69]">Electronics</span>
            </div>
        </div>
    </nav>

    <div id="main-view">
        <div id="loading" class="text-center py-20">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-[#232f3e]"></i>
            <p class="mt-2 text-gray-500">Loading Products...</p>
        </div>
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 gap-2 p-2"></div>
        
        <div class="mt-8 bg-white py-8 px-5 text-center border-t shadow-sm">
            <h2 class="text-xl font-bold text-[#232f3e] mb-2">Why Shop at BS MART?</h2>
            <div class="flex justify-center gap-4 text-xs text-gray-600 mb-6">
                <div class="flex flex-col items-center"><i class="fa-solid fa-truck-fast text-2xl text-[#febd69] mb-1"></i><span>Fast Delivery</span></div>
                <div class="flex flex-col items-center"><i class="fa-solid fa-shield-halved text-2xl text-[#febd69] mb-1"></i><span>Secure Payment</span></div>
            </div>
            <div class="text-left text-sm text-gray-600 space-y-2 bg-gray-50 p-4 rounded-lg">
                <p><strong>BS MART</strong> is your premium destination for fashion and electronics.</p>
                <p><i class="fa-solid fa-envelope text-[#febd69] mr-2"></i> Support: <a href="mailto:bhatsuheem906@gmail.com" class="text-blue-600 font-bold">bhatsuheem906@gmail.com</a></p>
            </div>
            <p class="text-xs text-gray-400 mt-6">Â© 2026 BS MART Inc.</p>
        </div>
    </div>

    <div id="product-page" class="fixed inset-0 bg-white z-[60] hidden overflow-y-auto fade-in">
        <div class="bg-[#232f3e] text-white p-3 flex items-center gap-3 sticky top-0 shadow">
            <button onclick="closeProductPage()"><i class="fa-solid fa-arrow-left text-lg"></i></button>
            <span class="font-bold truncate" id="pp-header-title">Details</span>
        </div>
        <div class="p-4 pb-32">
            <div class="relative">
                <div class="h-72 flex justify-center items-center bg-gray-50 mb-4 rounded-lg border">
                    <img id="pp-img" src="" class="max-h-full max-w-full object-contain">
                </div>
                <span id="pp-badge" class="hidden absolute top-2 right-2 bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow animate-pulse"></span>
            </div>
            <h1 id="pp-title" class="text-lg font-medium text-gray-800 leading-snug mb-2"></h1>
            <div class="bg-gray-50 p-3 rounded mb-4 border border-gray-100">
                <div class="flex items-baseline gap-2">
                    <span id="pp-discount-text" class="text-orange-600 text-xl font-light hidden"></span>
                    <span class="text-3xl font-bold text-gray-900">â‚¹<span id="pp-price"></span></span>
                </div>
                <p id="pp-mrp-block" class="text-xs text-gray-500 mt-1 hidden">M.R.P.: <span class="line-through" id="pp-old-price"></span></p>
            </div>
            
            <div id="size-section" class="mb-5">
                <p class="font-bold text-sm mb-2 text-gray-800">Select Size</p>
                <div class="flex gap-3">
                    <button onclick="selectSize(this, 'S')" class="size-btn border rounded-md px-4 py-2 text-sm font-bold hover:bg-gray-100">S</button>
                    <button onclick="selectSize(this, 'M')" class="size-btn border rounded-md px-4 py-2 text-sm font-bold hover:bg-gray-100">M</button>
                    <button onclick="selectSize(this, 'L')" class="size-btn border rounded-md px-4 py-2 text-sm font-bold hover:bg-gray-100">L</button>
                    <button onclick="selectSize(this, 'XL')" class="size-btn border rounded-md px-4 py-2 text-sm font-bold hover:bg-gray-100">XL</button>
                </div>
                <p id="size-error" class="text-red-500 text-xs mt-1 hidden font-bold">Please select a size!</p>
            </div>

            <hr class="border-gray-200 my-4">
            
            <div class="mb-6">
                <h3 class="font-bold text-md mb-2">Description</h3>
                <p id="pp-desc" class="text-sm text-gray-600 leading-relaxed"></p>
            </div>
            
            <div class="mb-6">
                <h3 class="font-bold text-md mb-3">Customer Reviews</h3>
                <div id="pp-reviews" class="space-y-4 mb-6"></div>
                
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h4 class="font-bold text-sm mb-2">Write a Review</h4>
                    <select id="review-stars" class="w-full border p-2 rounded text-sm mb-2 text-yellow-500 font-bold">
                        <option value="â˜…â˜…â˜…â˜…â˜…">â˜…â˜…â˜…â˜…â˜… (Excellent)</option>
                        <option value="â˜…â˜…â˜…â˜…â˜†">â˜…â˜…â˜…â˜…â˜† (Good)</option>
                    </select>
                    <textarea id="review-text" class="w-full border p-2 rounded text-sm mb-2" placeholder="Describe your experience..."></textarea>
                    <button onclick="submitReview()" class="w-full bg-[#232f3e] text-white text-sm py-2 rounded font-bold hover:bg-black">Submit Review</button>
                </div>
            </div>

            <div class="fixed bottom-0 left-0 right-0 bg-white p-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                <button onclick="openCheckoutFromPage()" class="w-full bg-[#ffd814] text-black py-3 rounded-full font-bold shadow-sm border border-[#fcd200] hover:bg-[#f7ca00]">Buy Now</button>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-70 z-[70] hidden flex items-center justify-center fade-in p-4">
        <div class="bg-white w-full max-w-sm rounded-lg p-5 relative shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h2 class="text-lg font-bold">Order Summary</h2>
                <button onclick="toggleModal('checkout-modal')" class="text-gray-500 text-2xl">&times;</button>
            </div>
            <form action="https://formsubmit.co/bhatsuheem906@gmail.com" method="POST">
                <input type="hidden" name="_next" value="https://bhatsuheem906.github.io/BS-MART/">
                <input type="hidden" name="_subject" value="New BS MART Order">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" id="form-name" name="Product">
                <input type="hidden" id="form-price" name="Price">
                <input type="hidden" id="form-size" name="Size">
                <div class="space-y-3">
                    <input type="text" name="Name" placeholder="Full Name" required class="w-full border rounded p-2 text-sm outline-none focus:border-[#e77600]">
                    <input type="tel" name="Mobile" placeholder="Mobile Number" required class="w-full border rounded p-2 text-sm outline-none focus:border-[#e77600]">
                    <textarea name="Address" placeholder="Full Address" required class="w-full border rounded p-2 text-sm outline-none focus:border-[#e77600]" rows="3"></textarea>
                    <div class="bg-gray-50 p-3 rounded border">
                        <p class="font-bold text-xs mb-2 text-gray-700">Payment Method</p>
                        <label class="flex items-center gap-2 mb-2 cursor-pointer">
                            <input type="radio" name="Payment" value="COD" checked onclick="showQR(false)" class="accent-[#e77600]">
                            <span class="text-sm">Cash on Delivery</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="Payment" value="Online" onclick="showQR(true)" class="accent-[#e77600]">
                            <span class="text-sm">UPI / QR Code</span>
                        </label>
                        <div id="qr-box" class="hidden text-center mt-2 border-t pt-2">
                            <img id="qr-img" src="" class="w-32 h-32 mx-auto border bg-white p-1">
                            <p class="text-[10px] text-red-500 mt-1 font-bold">Scan & Pay Now</p>
                        </div>
                    </div>
                </div>
                <button type="submit" class="w-full bg-[#ffd814] border border-[#fcd200] py-3 rounded-lg font-bold mt-4 shadow hover:bg-[#f7ca00]">Place Order</button>
            </form>
        </div>
    </div>

    <div id="admin-panel" class="fixed inset-0 bg-black bg-opacity-80 z-[80] hidden flex items-center justify-center fade-in">
        <div class="bg-white p-6 rounded w-80 max-h-[80vh] overflow-y-auto">
            <h3 class="font-bold text-lg mb-3">Add Product</h3>
            <p class="text-xs text-gray-500 mb-4">Adding directly to Google Sheet is recommended.</p>
            <form onsubmit="event.preventDefault(); uploadProduct();" class="space-y-2">
                <input type="text" id="a-name" placeholder="Product Title" class="w-full border p-2 rounded text-sm">
                <div class="flex gap-2">
                    <input type="number" id="a-price" placeholder="Price (â‚¹)" class="w-full border p-2 rounded text-sm">
                    <input type="number" id="a-old-price" placeholder="MRP (Old Price)" class="w-full border p-2 rounded text-sm bg-orange-50">
                </div>
                <select id="a-cat" class="w-full border p-2 rounded text-sm">
                    <option value="Mens Wear">Mens Wear</option>
                    <option value="Womens">Womens</option>
                    <option value="Electronics">Electronics</option>
                </select>
                <textarea id="a-desc" placeholder="Product Description..." class="w-full border p-2 rounded text-sm"></textarea>
                <p class="text-xs font-bold">Image (Upload from Phone)</p>
                <input type="file" id="a-img" class="w-full text-xs">
                <button type="submit" id="upload-btn" class="w-full bg-[#232f3e] text-white py-2 rounded mt-2">Add Product</button>
                <button type="button" onclick="toggleModal('admin-panel')" class="w-full text-gray-500 mt-2 text-sm">Close</button>
            </form>
        </div>
    </div>

    <script>
        let allProducts = [];
        let currentProduct = null;
        let selectedSize = null;

        // FAKE REVIEWS POOL (Used if Sheet is empty)
        const fakeReviews = [
            "Amazing quality for this price! ðŸ˜|Very comfortable fabric.|Delivery was super fast.",
            "Best purchase ever.|Fitting is perfect.|Will order again for sure.",
            "Material is soft and durable.|Looks exactly like the photo.|Value for money ðŸ’¯",
            "Highly recommended!|Got my parcel in 3 days.|Packing was good."
        ];

        fetch(API_URL).then(res => res.json()).then(data => {
            allProducts = data;
            document.getElementById('loading').style.display = 'none';
            renderGrid(data);
        });

        function getOldPrice(p) {
            return p.Old_Price || p["Old Price"] || p.old_price || p["old price"] || p.MRP || 0;
        }

        function renderGrid(products) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = "";
            products.forEach(p => {
                const name = p.Name || p.name;
                const price = Number(p.Price || p.price);
                const img = p.Image || p.image || "https://via.placeholder.com/150";
                const oldPrice = Number(getOldPrice(p)); 

                let discountHTML = "";
                let oldPriceHTML = "";
                
                if (oldPrice > price) {
                    const percent = Math.floor(((oldPrice - price) / oldPrice) * 100);
                    discountHTML = `<span class="absolute top-2 left-2 bg-orange-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded">${percent}% off</span>`;
                    oldPriceHTML = `<span class="text-xs text-gray-500 line-through">â‚¹${oldPrice}</span>`;
                }

                grid.innerHTML += `
                    <div onclick='showProductPage(${JSON.stringify(p)})' class="bg-white p-2 rounded-lg border border-gray-200 shadow-sm relative cursor-pointer hover:shadow-md">
                        ${discountHTML}
                        <div class="h-40 flex justify-center items-center bg-gray-50 mb-2 rounded overflow-hidden">
                            <img src="${img}" class="h-full object-contain mix-blend-multiply">
                        </div>
                        <h3 class="text-xs font-bold text-gray-800 line-clamp-2 h-8 leading-4 mb-1">${name}</h3>
                        <div class="flex items-baseline gap-1 mt-1">
                            <span class="text-sm font-bold text-gray-900">â‚¹${price}</span>
                            ${oldPriceHTML}
                        </div>
                        <p class="text-[10px] text-green-600 mt-1 font-bold">FREE Delivery</p>
                    </div>
                `;
            });
        }

        function showProductPage(product) {
            currentProduct = product;
            selectedSize = null;
            const price = Number(product.Price || product.price);
            document.getElementById('pp-img').src = product.Image || product.image;
            document.getElementById('pp-title').innerText = product.Name || product.name;
            document.getElementById('pp-header-title').innerText = (product.Name || product.name).substring(0, 15) + "...";
            document.getElementById('pp-price').innerText = price;
            document.getElementById('pp-desc').innerText = product.Description || "High quality product.";

            const oldPrice = Number(getOldPrice(product));
            const badge = document.getElementById('pp-badge');
            const discText = document.getElementById('pp-discount-text');
            const mrpBlock = document.getElementById('pp-mrp-block');
            
            if (oldPrice > price) {
                const percent = Math.floor(((oldPrice - price) / oldPrice) * 100);
                badge.innerText = `${percent}% OFF`; badge.classList.remove('hidden'); 
                discText.innerText = `-${percent}%`; discText.classList.remove('hidden');
                document.getElementById('pp-old-price').innerText = "â‚¹" + oldPrice; mrpBlock.classList.remove('hidden');
            } else {
                badge.classList.add('hidden'); discText.classList.add('hidden'); mrpBlock.classList.add('hidden');
            }

            // --- SMART REVIEWS LOGIC ---
            // If reviews exist in sheet, use them. If not, pick a RANDOM fake one from my list.
            const reviewsDiv = document.getElementById('pp-reviews');
            reviewsDiv.innerHTML = "";
            
            let rawReviews = product.Reviews || product.reviews;
            
            if (!rawReviews) {
                // AUTO-FAKE: Select random fake reviews so it doesn't look empty
                rawReviews = fakeReviews[Math.floor(Math.random() * fakeReviews.length)];
            }

            rawReviews.split('|').forEach(r => {
                reviewsDiv.innerHTML += `
                    <div class="text-sm border-b pb-2">
                        <div class="flex items-center gap-1 mb-1">
                            <i class="fa-solid fa-user-circle text-gray-400 text-lg"></i>
                            <span class="font-bold text-xs text-gray-700">Verified User</span>
                        </div>
                        <div class="text-yellow-500 text-xs">â˜…â˜…â˜…â˜…â˜…</div>
                        <p class="text-gray-600 text-xs mt-1">${r}</p>
                    </div>
                `;
            });

            document.querySelectorAll('.size-btn').forEach(b => { b.classList.remove('bg-[#fcd200]', 'border-[#e77600]', 'text-black'); });
            document.getElementById('size-error').classList.add('hidden');
            document.getElementById('main-view').classList.add('hidden');
            document.getElementById('product-page').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // --- SUBMIT REVIEW FUNCTION ---
        function submitReview() {
            const text = document.getElementById('review-text').value;
            const stars = document.getElementById('review-stars').value;
            
            if(!text) return alert("Please write a review first.");
            
            // 1. Show it to the customer immediately (Satisfaction)
            const reviewsDiv = document.getElementById('pp-reviews');
            reviewsDiv.innerHTML += `
                <div class="text-sm border-b pb-2 bg-green-50 p-2 rounded">
                    <div class="flex items-center gap-1 mb-1">
                        <i class="fa-solid fa-check-circle text-green-600"></i>
                        <span class="font-bold text-xs text-gray-700">You (Just Now)</span>
                    </div>
                    <div class="text-yellow-500 text-xs">${stars}</div>
                    <p class="text-gray-600 text-xs mt-1">${text}</p>
                </div>
            `;
            
            document.getElementById('review-text').value = "";
            
            // 2. Alert the ADMIN (Simulated)
            alert("Review Submitted! \n\nNOTE TO ADMIN: To make this review permanent, please copy it and paste it into your Google Sheet 'Reviews' column.");
        }

        function closeProductPage() {
            document.getElementById('product-page').classList.add('hidden');
            document.getElementById('main-view').classList.remove('hidden');
        }

        function selectSize(btn, size) {
            selectedSize = size;
            document.querySelectorAll('.size-btn').forEach(b => { b.classList.remove('bg-[#fcd200]', 'border-[#e77600]', 'text-black'); });
            btn.classList.add('bg-[#fcd200]', 'border-[#e77600]', 'text-black');
            document.getElementById('size-error').classList.add('hidden');
        }

        function openCheckoutFromPage() {
            if (!selectedSize && (currentProduct.Category || "").includes("Wear")) {
                document.getElementById('size-error').classList.remove('hidden'); return;
            }
            document.getElementById('form-name').value = currentProduct.Name || currentProduct.name;
            document.getElementById('form-price').value = currentProduct.Price || currentProduct.price;
            document.getElementById('form-size').value = selectedSize || "Universal";
            toggleModal('checkout-modal');
        }

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
        function showQR(show) { document.getElementById('qr-img').src = QR_CODE_IMAGE; document.getElementById('qr-box').classList.toggle('hidden', !show); }
        function searchProducts() { const q = document.getElementById('search').value.toLowerCase(); renderGrid(allProducts.filter(p => (p.Name || p.name).toLowerCase().includes(q))); }
        function filterProducts(c) { renderGrid(c === 'All' ? allProducts : allProducts.filter(p => (p.Category || p.category) === c)); }

        let taps = 0;
        function adminLoginTrigger() {
            taps++;
            if(taps === 5) {
                if(prompt("Admin Password") === "admin123") toggleModal('admin-panel');
                taps = 0;
            }
        }
        
        function uploadProduct() {
            const btn = document.getElementById('upload-btn');
            const file = document.getElementById('a-img').files[0];
            if(!file) return alert("Select Image");
            btn.innerText = "Saving...";
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const payload = {
                    action: "add",
                    name: document.getElementById('a-name').value,
                    price: document.getElementById('a-price').value,
                    old_price: document.getElementById('a-old-price').value,
                    category: document.getElementById('a-cat').value,
                    image: e.target.result,
                    description: document.getElementById('a-desc').value
                };
                
                fetch(API_URL, {
                    method: "POST", mode: "no-cors",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(payload)
                }).then(() => {
                    alert("Added! (Might take a moment to appear)");
                    location.reload();
                });
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
